<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <title>Explorando Métodos Mágicos no PHP: Conceitos e Exemplos Práticos | Dias de Dev</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <meta name="robots" content="index, follow">
    <meta name="title" content="Explorando Métodos Mágicos no PHP: Conceitos e Exemplos Práticos | Dias de Dev">
    <meta name="keywords" content="PHP, métodos mágicos, programação orientada a objetos, orientação a objetos, programação PHP, desenvolvimento web, Dias de Dev">
    <meta name="description" content="Descubra como os métodos mágicos no PHP permitem a execução implícita de ações específicas. Explore exemplos práticos que ilustram seu uso em programação orientada a objetos. Aprenda como aproveitar esse recurso poderoso do PHP.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:article:published_time" content="1691712000">
    <meta property="og:url" content="https://dias.dev/2023-08-11-metodos-magicos-php/">
    <meta property="og:title" content="Explorando Métodos Mágicos no PHP: Conceitos e Exemplos Práticos | Dias de Dev">
    <meta property="og:description" content="Descubra como os métodos mágicos no PHP permitem a execução implícita de ações específicas. Explore exemplos práticos que ilustram seu uso em programação orientada a objetos. Aprenda como aproveitar esse recurso poderoso do PHP.">
    <meta property="og:image" content="https://dias.dev/assets/img/thumbs/2023-08-11-metodos-magicos-php.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="https://dias.dev/2023-08-11-metodos-magicos-php/">
    <meta property="twitter:title" content="Explorando Métodos Mágicos no PHP: Conceitos e Exemplos Práticos | Dias de Dev">
    <meta property="twitter:description" content="Descubra como os métodos mágicos no PHP permitem a execução implícita de ações específicas. Explore exemplos práticos que ilustram seu uso em programação orientada a objetos. Aprenda como aproveitar esse recurso poderoso do PHP.">
            <link rel="preload" href="/build/Baloo2-Bold.ttf" as="font" type="font/ttf" crossorigin>
        <link rel="preload" href="/build/Baloo2-ExtraBold.ttf" as="font" type="font/ttf" crossorigin>
        <link rel="preload" href="/build/Baloo2-Medium.ttf" as="font" type="font/ttf" crossorigin>
        <link rel="preload" href="/build/Baloo2-Regular.ttf" as="font" type="font/ttf" crossorigin>
        <link rel="preload" href="/build/Baloo2-SemiBold.ttf" as="font" type="font/ttf" crossorigin>
        <link rel="preload" href="/build/FugazOne-Regular.ttf" as="font" type="font/ttf" crossorigin>
        <link rel="stylesheet" href="/build/app.css">

        
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Dias de Dev activity feed" />
                    <link rel="stylesheet" href="/build/post.css">
                    </head>
    <body>
        <div class="global-container">
            <header>
                <div class="header-title">
                    <h1 class="main-heading">
                        <a aria-current="page" href="/">Dias de Dev</a>
                    </h1>
                </div>
                <nav class="menu">
                    <a aria-current="page" href="/">Home</a>
                    <a href="/categorias">Categorias</a>
                                        <a href="/sobre-mim/">Sobre Mim</a>
                    <a href="https://youtube.com/@DiasDeDev" target="_blank">
                        YouTube
                    </a>
                </nav>
            </header>
            <main role="main">
                    <article itemscope itemtype="https://schema.org/Article">
        <header>
            <h1 itemprop="headline" class="post-title">
                Explorando Métodos Mágicos no PHP: Conceitos e Exemplos Práticos
            </h1>
            <p class="post-date" itemprop="dateCreated">
                11 de agosto de 2023
            </p>
        </header>
        <div itemprop="articleBody">
            <p>Os métodos mágicos no PHP são métodos "especiais" que são invocadas implicitamente quando certas ações ocorrem. Neste post, exploraremos esses métodos, como eles funcionam e como podem ser úteis.</p>

<h3 id="m%C3%A9todos-m%C3%A1gicos%3A-uma-vis%C3%A3o-geral">Métodos mágicos: Uma visão geral</h3>

<p>PHP é uma linguagem de programação que suporta, dentre outros, o paradigma de programação orientada a objetos. Sendo assim, podemos definir métodos dentro das nossas classes, ou seja, funções que operam no contexto de um objeto. Métodos mágicos são aqueles que podemos definir em nosso código e são acionados automaticamente pelo PHP em situações específicas.</p>

<p>Alguns exemplos de quando os métodos mágicos podem ser acionados incluem tentativas de acesso a membros inexistentes ou inacessíveis de uma classe, conversões de objetos e verificações especiais.</p>

<h2 id="exemplo-pr%C3%A1tico">Exemplo prático</h2>

<p>Um exemplo claro dos métodos mágicos em ação é o caso do framework Laravel. Considere uma classe de modelo (<em>Model</em>) que lida com a persistência de um usuário:</p>

<pre><code class="php">&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{ }
</code></pre>

<p>Apesar de não definir nenhuma propriedade explicitamente, podemos atribuir valores a propriedades como se elas existissem:</p>

<pre><code class="php">&lt;?php

use App\Models\User;

$user = new User();
$user-&gt;name = 'Vinicius Dias';
$user-&gt;email = 'email@example.com';
$user-&gt;save();
</code></pre>

<p>O método <code>save</code> é entendido como parte da classe base <code>Model</code>, mas e quanto às propriedades? Para cenários como esse, os métodos mágicos foram concebidos.</p>

<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-8918461095244552"
data-ad-slot="2366637560"></ins></p>

<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<h2 id="implementa%C3%A7%C3%A3o-de-m%C3%A9todos-m%C3%A1gicos">Implementação de métodos mágicos</h2>

<p>O nome de todo método mágico no PHP começa com dois underscores (<code>__</code>). Por exemplo, o método <code>__set</code> é invocado quando tentamos atribuir um valor a uma propriedade inexistente ou inacessível. Ele recebe o nome da propriedade e o valor como parâmetros:</p>

<pre><code class="php">&lt;?php

class NossaModel
{
    /**
     * @var array&lt;string, mixed&gt; Array associativo contendo todos os valores que definirmos
     */
    private array $atributos;

    /**
     * @param string $name Nome da propriedade inacessível que estamos tentando definir
     * @param mixed $value Valor que estamos tentando atribuir a essa propriedade
     * @return void
     */
    public function __set(string $name, mixed $value): void
    {
        /*
         * Aqui, se fizermos $model-&gt;teste = 'Valor', criaremos a chave 'teste'
         * na propriedade $atributos com o valor 'Valor'
         */
        $this-&gt;atributos[$name] = $value;
    }
}
</code></pre>

<p>Repare que o código que escrevemos no método é código PHP como qualquer outro. Ali nós poderíamos realizar qualquer tipo de lógica.</p>

<h3 id="como-acessar-esse-valor%3F">Como acessar esse valor?</h3>

<p>Aprendemos a definir um valor a partir de uma propriedade inexistente, mas se tentarmos ler esse valor, receberemos um erro. O código a seguir, por exemplo, falha:</p>

<pre><code class="php">$teste = new NossaModel();
$teste-&gt;nome = 'Vinicius';

/*
 * Na linha a seguir, o retorno será nulo e um _Warning_ será emitido
 * dizendo que a propriedade NossaModel::$nome não existe.
 */
echo $teste-&gt;nome;
</code></pre>

<p>Para escrever em propriedades inexistentes, usamos o <code>__set</code>. Já para ler de propriedades inexistentes ou inacessíveis, utilizamos o método <code>__get</code>. Então poderíamos ter o seguinte método na classe <code>NossaModel</code>:</p>

<pre><code class="php">/**
 * @param string $name Nome da propriedade inexistente que estamos tentando ler
 * @return mixed Aqui devemos retornar o valor que corresponderá a essa propriedade 
 */
public function __get(string $name): mixed
{
    // O valor retornado pelo método __get é utilizado onde tentamos acessar a propriedade 
    return $this-&gt;atributos[$name];
}
</code></pre>

<p>Com isso, o código a seguir funcionaria sem problemas:</p>

<pre><code class="php">$teste = new NossaModel();
// Chamada implícita a $teste-&gt;__set('nome', 'Vinicius');
$teste-&gt;nome = 'Vinicius';

// Chamada implícita a $teste-&gt;__get('nome'), que vai retornar 'Vinicius'
echo $teste-&gt;nome;
</code></pre>

<h2 id="mais-m%C3%A9todos">Mais métodos</h2>

<p>Até aqui nós citamos apenas 2 métodos mágicos, mas o PHP fornece diversos outros. Vou deixar a seguir uma lista deles:</p>

<h3 id="construtor-e-destrutor">Construtor e destrutor</h3>

<p>O método construtor, chamado de <code>__construct</code>, é executado quando criamos um novo objeto (utilizando <code>new</code>). Normalmente utilizamos o método construtor para receber dependências e inicializar as propriedades.</p>

<p>Já o método destrutor, <code>__destruct</code>, é executado quando um objeto sai de escopo ou quando o objeto é passado para a função <code>unset</code>. Normalmente ele é utilizado para liberar recursos que tenham sido alocados no construtor, como fechar arquivos, conexões, etc. Com a natureza <em>stateless</em> do PHP, esse método não é tão utilizado.</p>

<h3 id="convers%C3%B5es">Conversões</h3>

<p>Em alguns cenários nós podemos querer utilizar nossos objetos como um tipo diferente. Se quisermos usar nosso objeto como uma string, por exemplo, podemos utilizar o método <code>__toString</code>. O que nós retornarmos nesse método é utilizado se nosso objeto for convertido para string de forma implícita ou explícita. Objetos de resposta HTTP, por exemplo, geralmente implementam esse método retornando o corpo da resposta.</p>

<pre><code class="php">&lt;?php

class Response
{
    private string $body;
    // Outras propriedades

    public function __toString() : string
    {
        return $this-&gt;body;
    }
}

$response = new Response();
// Definição dos valores

echo $response; // Isso usa o objeto como string, logo, chama o __toString
</code></pre>

<p>Há também casos onde queremos utilizar nosso objeto como se ele fosse uma função. Para isso existe o método <code>__invoke</code>. Se nós passarmos nosso objeto por parâmetro em algum lugar que espera um <code>callable</code>, o método <code>__invoke</code> será executado. Exemplo:</p>

<pre><code class="php">&lt;?php

class ControllerDeExemplo
{
    public function __invoke(int $parametro1, string $parametro2): void
    {
        // Execução de exemplo
    }
}

$controller = new ControllerDeExemplo();

$controller(1, 'Teste'); // Isso executará o método __invoke
</code></pre>

<h3 id="chamada-de-m%C3%A9todos">Chamada de métodos</h3>

<p>Assim como nós podemos acessar propriedades inexistentes (ou inacessíveis) com métodos mágicos, o mesmo serve para métodos. Se você tentar chamar um método não existente de um objeto, o método <code>__call</code> será executado, recebendo o nome do método que tentou ser executado e todos os seus parâmetros. Já o <code>__callStatic</code> funciona da mesma forma, mas caso um método <strong>estático</strong> inexistente seja chamado a partir de uma classe.</p>

<pre><code class="php">class Exemplo
{
    public function __call(string $name, array $arguments): mixed
    {
        /*
         * $name possui o nome do método inexistente que foi executado,
         * enquanto $arguments possui todos os parâmetros que foram passados para esse método
         */
    }

    public static function __callStatic(string $name, array $arguments): mixed
    {
        // Equivalente estático ao __call
    }
}

// Chama implicitamente Exemplo::__callStatic('qualquerCoisa', [1, 2]):
Exemplo::qualquerCoisa(1, 2);

$objeto = new Exemplo();

// Chama implicitamente $objeto-&gt;__call('qualquerCoisa', [1, 2]):
$objeto-&gt;qualquerCoisa(1, 2);
</code></pre>

<h3 id="restante-dos-m%C3%A9todos">Restante dos métodos</h3>

<p>Para que esse post não fique ainda maior, vou deixar a seguir uma lista dos demais métodos mágicos com uma breve descrição, mas caso você queira ver mais exemplos e detalhes, pode conferir a <a href="https://www.php.net/manual/en/language.oop5.magic.php">documentação do PHP</a>.</p>

<ul>
<li><code>__isset</code>: Método executado caso passemos alguma propriedade inacessível do nosso objeto para a função <code>isset</code> ou <code>empty</code>;</li>
<li><code>__unset</code>: Método executado caso passemos alguma propriedade inacessível do nosso objeto para a função <code>unset</code>;</li>
<li><code>__sleep</code>: Ao chamar a função <code>serialize</code> passando nosso objeto, esse método é executado <strong>antes</strong> da serialização. Seu retorno deve ser um array contendo os nomes das propriedades do objeto em questão que serão serializadas. Normalmente é utilizado para remover propriedades que não devem ser serializadas com conexões com o banco, arquivos abertos, etc;</li>
<li><code>__wakeup</code>: Esse método não recebe parâmetros e é executado <strong>após</strong> um dado ser desserializado e o objeto ser criado. Esse método geralmente reconstrói os recursos como conexões com o banco;</li>
<li><code>__serialize</code>: Similar ao <code>__sleep</code>. Se ambos estiverem definidos, apenas <code>__serialize</code> é chamado e <code>__sleep</code> é ignorado. A diferença é que o <code>__serialize</code> deve retornar um array associativo que será serializado ao invés de retornar os nomes das propriedades do objeto;</li>
<li><code>__unserialize</code>: Similar ao <code>__wakeup</code>. Se ambos estiverem definidos, apenas <code>__unserialize</code> é chamado e <code>__wakeup</code> é ignorado. <code>__unserialize</code> recebe por parâmetro o array que foi serializado e com isso, deve reconstruir o objeto;</li>
<li><code>static __set_state</code>: Esse método é o mais raro. Ele é utilizado para criar um objeto da classe em questão a partir da função <code>var_export</code>;</li>
<li><code>__clone</code>: Método chamado quando um clone de um objeto é criado. <code>$this</code> nesse método vai se referir ao novo objeto criado. Normalmente esse método é definido para evitar <em>shallow copies</em> e realizar os clones de todas as propriedades também;</li>
<li><code>__debugInfo</code>: O retorno desse método deve conter os dados que serão exibidos pela função <code>var_dump</code>. Geralmente é um array associativo;</li>
</ul>

<h2 id="conclus%C3%A3o">Conclusão</h2>

<p>O PHP possui um grande número de métodos mágicos. Alguns são bastante fáceis de entender como <code>__get</code>, <code>__set</code> e <code>__call</code>, enquanto outros são mais confusos como as diferenças entre <code>__sleep</code> e <code>__serialize</code>. Há ainda aqueles bem pouco usados como o <code>__set_state</code>.</p>

<p>Lembrar de todos os métodos (e suas assinaturas) e o que cada um deles faz não é necessário, mas é importante saber da existência deles para saber o que pesquisar quando for necessário.</p>

<p>Se quiser aprender mais sobre PHP como um todo e sobre tecnologia em geral, vou deixar aqui um cupom de 10% de desconto na Alura, plataforma onde eu gravei inúmeros cursos: <a href="https://alura.tv/diasdedev">https://alura.tv/diasdedev</a>.</p>

        </div>
        <footer class="post-footer" itemprop="author" itemscope itemtype="https://schema.org/Person">
            <img src="https://gravatar.com/avatar/63579c5a873f3ab6abff10803e9a252f.jpg?s=50"
                 alt="Foto do Vinicius Dias com o microfone na mão durante uma palestra"
                 width="50"
                 height="50"
                 itemprop="image" />
            <p>
                Escrito por
                <a href="/sobre-mim/" itemprop="url">
                    <span itemprop="name">Vinicius Dias</span>
                </a>
            </p>
        </footer>

                    <nav class="article-navigation">
                <ul>
                    <li>
                                                <a class="previous" href="/2023-08-01-como-remover-acentos-de-palavras-com-php/" title="Como remover acentos de palavras com PHP">
                            ← <span class="title">Como remover acentos de palavras com PHP</span>
                        </a>
                                            </li>
                    <li>
                                                <a class="next" href="/2023-11-17-novidades-do-php-8-3/" title="Novidades do PHP 8.3: O que há de novo nessa versão do PHP">
                            <span class="title">Novidades do PHP 8.3: O que há de novo nessa versão do PHP</span> →
                        </a>
                                            </li>
                </ul>
            </nav>
            </article>



            </main>
            <footer class="global-footer">&copy; 2023 Dias de Dev</footer>
        </div>

        <script src="/build/app.js"></script>
                
        <!-- Simple Analytics -->
        <script defer src="https://sa.dias.dev/latest.js"></script>
        <script defer src="https://sa.dias.dev/auto-events.js"></script>
        <noscript>
            <img src="https://sa.dias.dev/noscript.gif"
                 alt=""
                 referrerpolicy="no-referrer-when-downgrade" />
        </noscript><!-- Google AdSense -->
        <script defer
                src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8918461095244552"
                crossorigin="anonymous"></script>
                </body>
</html>
