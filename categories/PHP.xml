<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[Dias de Dev]]></title>
    <link href="https://dias.dev/categories/PHP.xml" rel="self"/>
    <link href="https://dias.dev"/>
    <updated>2024-05-09T17:32:47+00:00</updated>
    <id>https://dias.dev/</id>
            <author>
            <name><![CDATA[Vinicius Dias]]></name>            <email><![CDATA[vinicius@dias.dev]]></email>        </author>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[Descubra Como o PHP Utiliza Copy on Write para Economizar Mem√≥ria]]></title>
            <link href="https://dias.dev/2024-04-18-copy-on-write-php/"/>
            <updated>2024-04-18T00:00:00+00:00</updated>
            <id>https://dias.dev/2024-04-18-copy-on-write-php/</id>
            <content type="html"><![CDATA[<p><em>CoW (Copy on Write)</em>, significa que um dado s√≥ √© copiado em mem√≥ria se alguma escrita for feita nele. No PHP, isso significa que os dados de um <em>array</em> s√≥ s√£o copiados se n√≥s realizarmos alguma escrita nessa c√≥pia, evitando um grande desperd√≠cio de mem√≥ria. Vem comigo nesse texto para entender melhor.</p>

<h2 id="_arrays_-e-consumo-de-mem%C3%B3ria"><em>Arrays</em> e consumo de mem√≥ria</h2>

<p>Um <em>array</em>, em diversas linguagens, utiliza uma <em>estrutura de dados</em> conhecida como <strong>vetor</strong>, enquanto em PHP uma estrutura conhecida como <em>HashMap</em> √© utilizada por baixo dos panos. Mas independente de qual estrutura de dados √© utilizada, uma coisa √© √≥bvia: <em>arrays</em> podem ocupar bastante espa√ßo na mem√≥ria. PS.: se quiser aprender sobre estruturas de dados com PHP, aqui tem um <a href="https://tidd.ly/4d42Myb">cupom de desconto para a Alura</a> e l√° tem cursos sobre o assunto. üòâ</p>

<p>Pensa naquela √∫ltima query super demorada que voc√™ fez e retorna um caminh√£o de dados do banco. Agora imagina armazenar isso tudo em sua aplica√ß√£o PHP. Isso vai ocupar espa√ßo. Inclusive, na maioria das vezes vamos usar pagina√ß√£o de dados para n√£o cairmos em alguns problemas, mas isso √© assunto para outro post.</p>

<p>Vamos simular de forma bastante simples um <em>array</em> grande, e vamos ver quanta mem√≥ria ele ocupa. Para isso, vamos usar a fun√ß√£o <code>memory_get_usage</code> para recuperar o uso de mem√≥ria e a fun√ß√£o <code>array_fill</code> para criar um <em>array</em> com muitos dados.</p>

<pre><code class="php">&lt;?php

// Armazena o uso de mem√≥ria inicial
$memoriaInicial = memory_get_usage();

// Cria um array de 1000 elementos
$arrayGrande = array_fill(0, 1000, 'Valor de exemplo');

$memoriaUsada = memory_get_usage() - $memoriaInicial;

// Exibe a mem√≥ria ocupada em KB
echo $memoriaUsada / 1024;
</code></pre>

<p>O trecho de c√≥digo acima vai mostrar que utilizamos aproximadamente 20 <em>kilobytes</em> ap√≥s copiarmos um array contendo 1000 strings. Agora vamos realizar uma c√≥pia desse array grande. Podemos fazer isso o passando por par√¢metro para uma fun√ß√£o, ou simplesmente o associando a uma nova vari√°vel:</p>

<pre><code class="php">// ...
$copiaDoArray = $arrayGrande;
</code></pre>

<p>Sendo assim, eu esperaria que a mem√≥ria utilizada agora fosse de aproximadamente 40 <em>kilobytes</em>, j√° que tenho o array ocupando 20 KB duas vezes. Por√©m, se eu realizo a medi√ß√£o, tenho uma surpresa:</p>

<pre><code class="php">// ...
echo (memory_get_usage() - $memoriaInicial) / 1024;
</code></pre>

<p>Eu vejo agora um uso de aproximadamente 21 KB, ou seja, o consumo de mem√≥ria praticamente n√£o mudou. Um √∫nico <em>kilobyte</em> extra foi necess√°rio para armazenar o novo array de 20 KBs. Como?</p>

<h2 id="copy-on-write---php-ao-resgate">Copy on Write - PHP ao resgate</h2>

<p>O PHP entende que arrays s√£o uma estrutura de dados muito comum, muito utilizada e muito poderosa. Por isso, h√° uma t√©cnica bastante comum implementada por baixo dos panos nos <em>arrays</em> do PHP: <em>Copy on Write</em>, ou, no bom e velho portugu√™s, c√≥pia somente no momento da escrita.</p>

<p>O que isso quer dizer √© que, ao realizar uma "c√≥pia" de um array, ou seja, ao passar um array por par√¢metro ou atribu√≠-lo a outra vari√°vel, o PHP n√£o realiza uma c√≥pia nos dados em mem√≥ria. Ele, na verdade, faz com que esse par√¢metro ou vari√°vel apontem para o mesmo endere√ßo de mem√≥ria do array original, nos poupando muita mem√≥ria, principalmente em cen√°rio de grandes volumes de dados.</p>

<p>Por√©m, se ambos apontam para o mesmo endere√ßo de mem√≥ria, isso significa que ao manipular os itens desse novo array, eu acabaria alterando o array original tamb√©m, certo? Errado. Da√≠ que vem o nome da t√©cnica de <em>copy on write</em>. Ao tentar realizar alguma manipula√ß√£o nos dados dessa "c√≥pia", s√≥ ent√£o os dados ser√£o efetivamente copiados. Sendo assim, podemos ver o aumento no uso de mem√≥ria com o seguinte trecho de c√≥digo:</p>

<pre><code class="php">// ...
$copiaDoArray[1] = 'Outro valor';
echo (memory_get_usage() - $memoriaInicial) / 1024;
</code></pre>

<p>Agora, ap√≥s modificar a vari√°vel <code>$copiaDoArray</code>, uma c√≥pia dos dados em mem√≥ria ser√° realmente feita, ent√£o o uso de mem√≥ria finalmente dobrar√° e veremos um uso de aproximadamente 42KB.</p>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p><em>Arrays</em> s√£o extremamente vers√°teis e poderosos no PHP e por isso s√£o amplamente utilizados (√†s vezes at√© mal utilizados). Pensando nisso, o PHP faz de tudo para que seu uso seja o mais otimizado poss√≠vel, e garantir que c√≥pias desnecess√°rias sejam evitadas nos poupa <strong>muita</strong> RAM.</p>

<p>Se voc√™ quiser aprender mais sobre as "entranhas" do PHP, manipula√ß√£o de mem√≥ria, otimiza√ß√£o al√©m de boas pr√°ticas, l√° na Alura eu tenho v√°rios cursos sobre o assunto (e sobre outros temas tamb√©m). Aqui tem um <a href="https://tidd.ly/4d42Myb">cupom de 15% desconto</a> para voc√™ aproveitar a plataforma.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[PHP Strict Types: Entendendo o Uso Pr√°tico da Diretiva declare(strict_types=1) no PHP]]></title>
            <link href="https://dias.dev/2023-12-28-entendendo-strict-types-no-php/"/>
            <updated>2023-12-28T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-12-28-entendendo-strict-types-no-php/</id>
            <content type="html"><![CDATA[<p>A diretiva <code>declare(strict_types=1)</code> √© amplamente utilizada no PHP, mas nem todos entendem o que ela faz na pr√°tica. Nesse texto n√≥s vamos entender como o comportamento do seu c√≥digo pode ser alterado ao usar essa diretiva.</p>

<h2 id="type-hints-no-php">Type hints no PHP</h2>

<p>O PHP possui o conceito de <em>Type Hints</em> que √© basicamente como n√≥s podemos informar os tipos que usaremos em alguns locais como em par√¢metros e retornos de fun√ß√µes. Ao informar o tipo de um par√¢metro, por exemplo, o PHP ir√° verificar se o valor passado √© compat√≠vel com o tipo informado. Por exemplo:</p>

<pre><code class="php">function soma(int $a, int $b): int
{
    return $a + $b;
}

soma('test 1', 'test 2'); // Fatal error: Uncaught TypeError: Argument 1 passed to soma() must be of the type int, string given
</code></pre>

<p>Repare que ao tentar passar uma string para uma fun√ß√£o que espera inteiros, um erro do tipo <code>TypeError</code> √© lan√ßado. Esse tipo de t√©cnica traz mais seguran√ßa para nosso c√≥digo de forma que conhecemos melhor os valores que manipulamos.</p>

<h2 id="malabarismo-com-tipos">Malabarismo com tipos</h2>

<p>Embora o PHP possua os famosos e muito √∫teis <em>type hints</em>, √© importante dizer que nem sempre eles s√£o seguidos √† risca. O PHP possui outro conceito chamado <em>type juggling</em> (malabarismo de tipos em tradu√ß√£o livre) que √© basicamente a convers√£o de tipos de forma impl√≠cita. Essa funcionalidade permite algumas facilidades bem interessantes, principalmente quando nos lembramos que o protocolo HTTP trabalha somente com texto. Se n√≥s recebessemos os dois n√∫meros para realizar a soma por uma requisi√ß√£o, eles viriam como <code>string</code>s, ent√£o o seguinte c√≥digo seria executado:</p>

<pre><code class="php">soma('1', '2'); // 3
</code></pre>

<p>Embora ainda estejamos passando strings por par√¢metro, agora a chamada da fun√ß√£o √© bem sucedida. Isso acontece, pois o PHP possui algo chamado <a href="https://www.youtube.com/watch?v=sKw-ruVP9cw">strings num√©ricas</a>. O exemplo anterior √© um caso onde a convers√£o autom√°tica dos tipos nos ajuda, por√©m h√° casos onde isso pode ser um problema. Se n√≥s tentarmos passar n√∫meros com ponto flutuante, por exemplo, o PHP ir√° remover a parte decimal dos n√∫meros:</p>

<pre><code class="php">soma(1.5, 2.5); // 3
</code></pre>

<p>Desde a vers√£o 8.1 o PHP emitir√° um aviso de obsol√™ncia (<em>deprecation notice</em>) quando tentamos converter <code>float</code> para <code>int</code>, mas ainda assim o c√≥digo √© executado e o resultado √© no m√≠nimo inesperado (para n√£o dizer incorreto).</p>

<h2 id="impedindo-convers%C3%B5es">Impedindo convers√µes</h2>

<p>Para impedir esse comportamento do PHP, n√≥s podemos usar a diretiva <code>declare(strict_types=1)</code> que ir√° for√ßar o PHP a seguir os <em>type hints</em> de forma mais r√≠gida, sem convers√µes impl√≠citas de tipos. Ao usar essa diretiva, o PHP ir√° lan√ßar um erro do tipo <code>TypeError</code> quando tentarmos passar um tipo diferente do esperado, mesmo que seja poss√≠vel realizar alguma convers√£o. Sendo assim, se onde eu chamo a fun√ß√£o <code>soma</code> houver a declara√ß√£o de <code>strict_types</code>, o c√≥digo lan√ßar√° um erro:</p>

<pre><code class="php">&lt;?php

declare(strict_types=1);

function soma(int $a, int $b): int
{
    return $a + $b;
}

soma('1', '2'); // Fatal error: Uncaught TypeError: Argument 1 passed to soma() must be of the type int, string given
soma(1.5, 2.5); // Fatal error: Uncaught TypeError: Argument 1 passed to soma() must be of the type int, float given
</code></pre>

<p>Um detalhe muito importante √© que a diretiva <code>declare(strict_types=1)</code> deve ser declarada no in√≠cio do arquivo, antes de qualquer c√≥digo.</p>

<h2 id="m%C3%BAltiplos-arquivos">M√∫ltiplos arquivos</h2>

<p>A diretiva <code>declare</code> agir√° no arquivo onde ela for declarada, ent√£o pode acontecer de termos um arquivo com <code>strict_types=1</code> e outro sem. Nesse cen√°rio, o PHP vai se comportar seguindo o que for declarado no arquivo que <strong>chama</strong> a fun√ß√£o e n√£o no arquivo que a declara. Exemplo:</p>

<pre><code class="php">&lt;?php
// arquivo functions.php

declare(strict_types=1);

function soma(int $a, int $b) {
    return $a + $b;
}
?&gt;

&lt;?php
// arquivo index.php

require_once 'functions.php';

echo soma('1', '2'); // 3
?&gt;
</code></pre>

<p>Repare que mesmo o arquivo <code>functions.php</code> possuindo a diretiva, o arquivo que executa a fun√ß√£o √© o <code>index.php</code> e ele n√£o informa a diretiva, logo, ela estar√° desabilitada. J√° no caso contr√°rio, o seguinte ocorrer√°:</p>

<pre><code class="php">// arquivo functions.php

function soma(int $a, int $b) {
    return $a + $b;
}
?&gt;

&lt;?php
// arquivo index.php

declare(strict_types=1);

require_once 'functions.php';

echo soma('1', '2'); // Fatal error: Uncaught TypeError: Argument 1 passed to soma() must be of the type int, string given
?&gt;
</code></pre>

<p>Mesmo o arquivo <code>functions.php</code> n√£o informando a diretiva <code>declare(strict_types=1)</code> o erro acontece, pois no arquivo <code>index.php</code> √© onde a chamada acontece e ele possui a diretiva.</p>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>Tipos em PHP podem ser um assunto espinhoso porque al√©m de complexo, nem todo dev concorda em como utiliz√°-los. Uns (como eu) acreditam que quanto mais estrito, melhor. Outros acreditam que <em>type hints</em> s√£o um desperd√≠cio. Mais uma coisa eu acredito que seja un√¢nime: √© muito importante para n√≥s, como devs PHP, entender como os tipos funcionam na linguagem com a qual trabalhamos.</p>

<p>Se voc√™ deseja explorar ainda mais o tema de tipos em PHP, recomendo a leitura de um artigo abrangente no blog Codamos. O conte√∫do discute detalhadamente os diversos tipos em PHP, suas manipula√ß√µes e convers√µes, e oferece uma an√°lise mais aprofundada sobre <code>strict_types</code>, inclusive com trechos de c√≥digo em C do PHP. Para acessar o artigo completo, visite <a href="https://codamos.com.br/tipos-em-php/">este link</a>. E se voc√™ quiser aprender mais sobre PHP, h√° <strong>muitos</strong> cursos gravados por mim l√° na Alura. Aqui tem um <a href="https://tidd.ly/4d42Myb">cupom de 15% de desconto</a> para assinar a plataforma.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Executando Fun√ß√µes Rust em PHP com FFI: Um Guia Passo a Passo]]></title>
            <link href="https://dias.dev/2023-12-18-usando-rust-com-php-e-ffi/"/>
            <updated>2023-12-18T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-12-18-usando-rust-com-php-e-ffi/</id>
            <content type="html"><![CDATA[<p>Usando FFI (<em>Foreign Function Interface</em>) √© poss√≠vel executar c√≥digo de outras linguagens em PHP. Neste artigo, vamos ver como executar fun√ß√µes escritas em Rust a partir do PHP usando FFI.</p>

<h2 id="ffi">FFI</h2>

<p>FFI n√£o √© uma particularidade do PHP, mas sim uma t√©cnica que permite que uma linguagem de programa√ß√£o execute c√≥digo de outra linguagem. Desde sua vers√£o 7.4, o PHP possui uma <a href="/2022-02-13-extensoes-php">extens√£o</a> chamada FFI que permite o uso dessa t√©cnica.</p>

<p>Para usar FFI, precisamos ter um arquivo compilado em formato de biblioteca. Normalmente s√£o arquivos <code>.so</code> no Linux e <code>.dll</code> no Windows. Esses arquivos podem ser gerados a partir de c√≥digo escrito em C, C++ ou Rust, por exemplo.</p>

<h2 id="gerando-uma-biblioteca-em-rust">Gerando uma biblioteca em Rust</h2>

<p>Entendido o conceito de FFI e sabendo que √© poss√≠vel executar essa t√©cnica com PHP, vamos criar uma biblioteca em Rust. Esse texto n√£o tem a inten√ß√£o de ser um tutorial de Rust, ent√£o vou assumir que voc√™ j√° possua o Rust e Cargo instalados corretamente em seu computador.</p>

<p>Para criar um novo projeto em Rust, execute o comando abaixo em uma pasta da sua escolha:</p>

<pre><code class="bash">cargo new --lib nossa-biblioteca
</code></pre>

<p>Com isso, alguns arquivos ser√£o criados. Voc√™ ter√° o arquivo de configura√ß√£o do projeto chamado <code>Cargo.toml</code> e o arquivo <code>lib.rs</code> que √© o arquivo principal da biblioteca.</p>

<p>No arquivo <code>Cargo.toml</code>, vamos adicionar a seguinte configura√ß√£o:</p>

<pre><code class="toml">[lib]
crate-type = ["cdylib"]
</code></pre>

<p>Com isso, n√≥s informamos ao Cargo que ao compilar nosso projeto, ele deve gerar uma biblioteca que pode ser utilizada por outras linguagens e n√£o apenas por outros projetos Rust.</p>

<p>Se voc√™ executar o comando <code>cargo build</code>, o projeto rec√©m-criado deve ser compilado sem nenhum problema.</p>

<h2 id="escrevendo-o-c%C3%B3digo-em-rust">Escrevendo o c√≥digo em Rust</h2>

<p>Para que a fun√ß√£o que n√≥s vamos escrever possa ser executada por outras linguagens, precisamos adotar algumas pr√°ticas e √© isso que veremos agora.</p>

<p>Nossa inten√ß√£o √© criar uma fun√ß√£o que receba dois n√∫meros e retorne a soma deles. No momento da escrita desse artigo, o c√≥digo de <code>src/lib.rs</code> j√° possui uma fun√ß√£o que faz isso, mas vamos alter√°-la para que ela possa ser usada por outras linguagens. Esse √© o c√≥digo inicial ao criar a biblioteca:</p>

<pre><code class="rust">pub fn add(left: usize, right: usize) -&gt; usize {
    left + right
}
</code></pre>

<p>Vamos come√ßar com os tipos. <code>usize</code> significa <em>unsigned size</em> e √© um tipo que representa um n√∫mero inteiro positivo. N√≥s queremos permitir o uso de n√∫meros negativos tamb√©m, ent√£o vamos alterar esse tipo. Para manter as coisas simples, vamos usar <code>i32</code> que √© um inteiro de 32 bits. Isso √© equivalente ao <code>int</code> de C em um sistema de 64 bits. Com essa altera√ß√£o, nosso c√≥digo fica assim:</p>

<pre><code class="rust">pub fn add(left: i32, right: i32) -&gt; i32 {
    left + right
}
</code></pre>

<h2 id="tornando-o-c%C3%B3digo-acess%C3%ADvel-por-outras-linguagens">Tornando o c√≥digo acess√≠vel por outras linguagens</h2>

<p>At√© agora escrevemos um c√≥digo perfeitamente funcional em Rust, mas ele ainda n√£o pode ser executado por outras linguagens que consigam executar bibliotecas. Ainda faltam algumas etapas.</p>

<p>A primeira √© justamente informar que essa fun√ß√£o chamada <code>add</code> pode ser chamada externamente. Isso √© feito com a diretiva <code>extern "C"</code> do Rust. Ao adicionar <code>extern "C"</code> antes de <code>fn</code> n√≥s informamos que a fun√ß√£o a seguir ser√° vis√≠vel para outras linguagens.</p>

<p>Mas ainda falta um √∫ltimo detalhe. Ao compilar um c√≥digo, todo compilador, independente da linguagem, realiza um processo chamado <em>Mangling</em>. Esse processo consiste em renomear a fun√ß√£o para adicionar informa√ß√µes ou √†s vezes at√© para manipular o tamanho do bin√°rio resultante da compila√ß√£o. O problema √© que cada compilador faz isso de uma forma diferente e isso impede que uma fun√ß√£o escrita em uma linguagem seja chamada por outra linguagem.</p>

<p>O Rust possui um atributo que, quando adicionado a uma fun√ß√£o, informa ao compilador que esse processo n√£o deve ser realizado. Dessa forma, nossa fun√ß√£o chamada <code>add</code> continuar√° se chamando <code>add</code> mesmo ap√≥s a compilac√£o. O nome do atributo √© <code>#[no_mangle]</code> e ele deve ser adicionado antes da fun√ß√£o. Com isso, nosso c√≥digo fica assim:</p>

<pre><code class="rust">#[no_mangle]
pub extern "C" fn add(left: i32, right: i32) -&gt; i32 {
    left + right
}
</code></pre>

<p>Com isso, nosso c√≥digo em Rust est√° pronto para ser executado por outras linguagens.</p>

<h2 id="compilando-a-biblioteca">Compilando a biblioteca</h2>

<p>Para compilar a biblioteca, basta executar o comando <code>cargo build</code> na pasta do projeto. O arquivo resultante da compila√ß√£o estar√° em <code>target/debug/libnossa_biblioteca.so</code> no Linux ou <code>target/debug/nossa_biblioteca.dll</code> no Windows.</p>

<p>O arquivo resultante da compila√ß√£o √© uma biblioteca que pode ser usada por outras linguagens.</p>

<h2 id="usando-a-biblioteca-em-php">Usando a biblioteca em PHP</h2>

<p>Agora que temos um arquivo <code>.so</code> ou <code>.dll</code> gerado, podemos us√°-lo em PHP. Para isso, vamos usar a extens√£o FFI.</p>

<p>Essa extens√£o possui algumas formas de ser utilizada e o prop√≥sito desse texto n√£o √© ser um tutorial sobre FFI tamb√©m. Ent√£o vou seguir com a abordagem mais simples, que √© informar dois par√¢metros √† fun√ß√£o <code>FFI::cdef</code>: o primeiro √© uma string contendo as assinaturas das fun√ß√µes que queremos usar e o segundo √© o caminho para a biblioteca que queremos usar.</p>

<p>Vamos criar um arquivo <code>ffi.php</code> na mesma pasta desse nosso projeto em Rust para realizar o teste. Nosso c√≥digo para utilizar a fun√ß√£o <code>add</code> do arquivo <code>target/debug/libnossa_biblioteca.so</code> (troque por <code>.dll</code> no Windows) fica assim:</p>

<pre><code class="php">$ffi = FFI::cdef(
    'int add(int left, int right);',
    __DIR__ . '/target/debug/libnossa_biblioteca.so'
);

var_dump($ffi-&gt;add(1, 2));
</code></pre>

<p>Caso voc√™ tenha a extens√£o FFI instalada e habilitada, o resultado ser√° <code>int(3)</code>. Isso significa que a fun√ß√£o <code>add</code> foi executada corretamente e retornou o valor <code>3</code>.</p>

<h2 id="considera%C3%A7%C3%B5es-sobre-tipos">Considera√ß√µes sobre tipos</h2>

<p>Repare que em Rust n√≥s escrevemos <code>i32</code> como o tipo dos par√¢metros e do retorno, enquanto no PHP n√≥s usamos <code>int</code>. A extens√£o FFI espera como defini√ß√£o das fun√ß√µes uma assinatura compat√≠vel com C e o tipo <code>i32</code>, como foi citado anteriormente, √© equivalente ao <code>int</code> de C. Por isso, podemos usar <code>int</code> no PHP sem problemas. Al√©m disso, diversas convers√µes s√£o feitas automaticamente pela extens√£o FFI, por isso o tipo <code>int</code> de C virou sem nenhum problema um <code>int</code> do PHP, embora por baixo dos panos eles sejam tipos bem diferentes.</p>

<h3 id="strings">Strings</h3>

<p>Tipos num√©ricos e booleanos s√£o relativamente f√°ceis de se lidar, mas e quanto a strings? Como podemos passar uma string para o Rust e/ou receber uma string de volta?</p>

<p>O Rust possui um m√≥dulo chamado <code>std::ffi</code> que √© exatamente pensado para trazer funcionalidades quando estivermos escrevendo c√≥digo que pode interagir com outras linguagens. Um dos tipos presentes nesse m√≥dulo √© o chamado <code>c_char</code> que √© equivalente ao <code>char</code> de C. Com isso, uma string que em C √© um ponteiro para um <code>char</code> pode ser representada em Rust como um ponteiro para um <code>c_char</code>. Logo, para receber uma string por par√¢metro ou para retornar uma string, bastaria utilizarmos <code>*const c_char</code> como tipo.</p>

<p>Exemplo de fun√ß√£o que recebe uma string e a retorna sem modifica√ß√µes:</p>

<pre><code class="rust">use std::ffi::c_char;

#[no_mangle]
pub extern "C" fn return_message(message: *const c_char) -&gt; *const c_char {
    message
}
</code></pre>

<p>Em PHP n√≥s poder√≠amos chamar essa fun√ß√£o da seguinte forma:</p>

<pre><code class="php">$ffi = FFI::cdef(
    'const char *return_message(const char *message);',
    __DIR__ . '/target/debug/libnossa_biblioteca.so'
);
var_dump($ffi-&gt;return_message('Hello, world!'));
</code></pre>

<p>E isso nos mostraria <code>string(13) "Hello, world!"</code>.</p>

<p>Por√©m, para manipularmos essa String em Rust, um ponteiro para <code>c_char</code> n√£o seria a melhor forma. Ent√£o podemos usar o tipo <code>std::ffi::CStr</code> para transformar esse ponteiro em uma string manipul√°vel da seguinte forma:</p>

<pre><code class="rust">let string: &amp;str = unsafe { CStr::from_ptr(message) }.to_str().unwrap();
</code></pre>

<p>Como estamos lidando com um ponteiro, o bloco <code>unsafe</code> √© necess√°rio. O m√©todo <code>to_str()</code> tenta transformar o <code>CStr</code> em uma string do Rust, mas isso pode falhar, ent√£o ele retorna um <code>Result</code>. Como sabemos que a string que estamos recebendo √© v√°lida, podemos usar o m√©todo <code>unwrap()</code> para obter a string sem precisar lidar com o <code>Result</code>.</p>

<p>Al√©m de <code>CStr</code> h√° tamb√©m o tipo <code>CString</code>. <code>CStr</code> est√° para <code>&amp;str</code> assim como <code>CString</code> est√° para <code>String</code> no Rust. Com isso n√≥s j√° conseguimos lidar normalmente com strings em Rust.</p>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>J√° que √© poss√≠vel chamar c√≥digos em Rust (ou outras linguagens como C ou C++) a partir do PHP, algumas tarefas que poderiam ser executadas de forma mais eficiente ou at√© de forma exclusiva a partir de linguagens compiladas ainda podem viver em projetos PHP.</p>

<p>Dois bons exemplos de caso de uso desse tipo de t√©cnica s√£o:</p>

<ol>
<li>pacote <code>php-tkui</code> que usa FFI para chamar o Tk, uma biblioteca gr√°fica escrita em C, o que permite <a href="https://youtube.com/watch?v=5yhJMcCVNSI">cria√ß√£o de aplica√ß√µes desktop usando PHP</a></li>
<li>Computa√ß√£o de grandes arquivos JSON ou Markdown, que embora seja perfeitamente poss√≠vel fazer diretamente me PHP, em alguns cen√°rios pode se tornar mais eficiente usando Rust + FFI.</li>
</ol>

<p>Se voc√™ quiser aprender mais tanto sobre Rust quanto sobre PHP, h√° cursos gravados por mim l√° na Alura. Aqui tem um <a href="https://tidd.ly/4d42Myb">cupom de 15% de desconto</a> para assinar a plataforma.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Novidades do PHP 8.3: O que h√° de novo nessa vers√£o do PHP]]></title>
            <link href="https://dias.dev/2023-11-17-novidades-do-php-8-3/"/>
            <updated>2023-11-17T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-11-17-novidades-do-php-8-3/</id>
            <content type="html"><![CDATA[<p>A vers√£o final do PHP 8.3 est√° agendada para ser lan√ßada no dia <a href="https://wiki.php.net/todo/php83">23 de novembro de 2023</a> e traz algumas novidades bem interessantes, contando com novas fun√ß√µes, novas classes e c√≥digo que passa a ser considerado obsoleto.</p>

<h2 id="modifica%C3%A7%C3%B5es-sobre-%60readonly%60">Modifica√ß√µes sobre <code>readonly</code></h2>

<p>Uma <em>RFC</em> intitulada <em>Readonly amendments</em> prop√µe duas mudan√ßas em como a palavra-chave <code>readonly</code> se comporta, por√©m apenas uma dessas mudan√ßas foi aceita. A partir da vers√£o 8.3 do PHP, √© poss√≠vel reinicializar propriedades <code>readonly</code> ao clonar objetos, ou seja, dentro do <a href="/2023-08-11-metodos-magicos-php">m√©todo m√°gico</a> <code>__clone</code>.</p>

<p>Isso torna o seguinte c√≥digo, que no PHP 8.2 causaria um erro, poss√≠vel:</p>

<pre><code class="php">&lt;?php

readonly class Usuario
{
    public function __construct(
        public \DateTimeImmutable $nascimento, 
    ) {}

    public function __clone() : void
    {
        $this-&gt;nascimento = clone $this-&gt;nascimento;
    }
}
</code></pre>

<p>Essa funcionalidade, embora pare√ßa pequena, permite que realizemos <em>deep copy</em> de objetos que possuam propriedades <code>readonly</code>.</p>

<p>Se quiser ver mais sobre essa nova funcionalidade, eu tenho um v√≠deo sobre ela em meu canal do YouTube:</p>

<p><lite-youtube videoid="yE2Ei9xsJnk">
    <a href="https://youtube.com/watch?v=yE2Ei9xsJnk" class="lite-youtube-fallback" title="Reproduzir v√≠deo">
        Novidades do PHP 8.3: Modifica√ß√µes sobre readonly | Dias de Dev
    </a>
</lite-youtube></p>

<h2 id="constantes-tipadas-em-classes">Constantes tipadas em classes</h2>

<p>A partir do PHP 8.3 √© poss√≠vel definirmos os tipos de constantes em nossas classes. Essa possibilidade nos traz mais seguran√ßa de tipos principalmente quando h√° heran√ßa entre classes ou implementa√ß√£o de interfaces que possuem constantes. At√© o PHP 8.2, uma classe poderia sobrescrever uma constante herdada adicionando qualquer valor, sem checagem de tipo. Isso poderia trazer problemas como o seguinte:</p>

<pre><code class="php">interface InterfaceTeste {
    const TEST = "Test";
}

class ClasseBase implements InterfaceTeste {
    const TEST = []; // Mudamos o tipo aqui
}

class ClasseDerivada extends ClasseBase {
    const TEST = null; // Mais uma vez, outro tipo
}
</code></pre>

<p>Ao acessar a constante <code>TEST</code> de algum objeto do tipo <code>InterfaceTeste</code>, n√£o havia nenhuma garantia que seu tipo sempre seria <code>string</code>. Com o PHP 8.3, o seguinte √© poss√≠vel:</p>

<pre><code class="php">interface InterfaceTeste {
    const string TEST = "Test";
}

class ClasseBase implements InterfaceTeste {
    const array TEST = []; // Isso falharia, pois muda o tipo da constante
}
</code></pre>

<h2 id="retorno-nulo-em-ffi">Retorno nulo em FFI</h2>

<p>Ao chamar uma fun√ß√£o que n√£o retorna nada, ou seja, <code>void</code>, via <code>FFI</code>, o PHP retornava um tipo espec√≠fico chamado <code>FFI\CData</code> com o valor <code>void</code>. Agora, assim como em uma fun√ß√£o PHP com o retorno <code>void</code>, n√≥s receberemos <code>null</code> dessa fun√ß√£o. Exemplo:</p>

<pre><code class="php">$ffi = FFI::cdef(
    "void free(void *ptr);",
    "libc.so.6"
);
// At√© o PHP 8.2, isso retornaria `FFI\CData`, agora retorna `null`
$ffi-&gt;free(/* ponteiro*/);
</code></pre>

<h2 id="atributo-%60%23%5Coverride%60-para-sobrescrita-de-m%C3%A9todos">Atributo <code>#[\Override]</code> para sobrescrita de m√©todos</h2>

<p>Um novo atributo chega ao PHP 8.3. O atributo <code>#[Override]</code> permite que o c√≥digo deixe claro que o m√©todo anotado com ele est√° sobrescrevendo um m√©todo da classe base, ou seja, caso haja alguma inconsist√™ncia na heran√ßa (como nome do m√©todo escrito errado) um erro de compila√ß√£o ser√° exibido.</p>

<p>Isso permite encontrar erros como o seguinte:</p>

<pre><code class="php">&lt;?php
class Conta
{
    public function saca(int $valor): void { /* implementa√ß√£o */ }
}

class ContaCorrente
{
    public function sacar(int $valor): void { /* implementa√ß√£o modificada */ }
}
</code></pre>

<p>O c√≥digo acima possui um erro sutil no nome do m√©todo. Ao chamar <code>(new ContaCorrente())-&gt;saca($valor)</code>, embora a inten√ß√£o seja chamar o m√©todo da classe <code>ContaCorrente</code> que sobrescreve o m√©todo da classe <code>Conta</code>, n√≥s na verdade estamos chamando o m√©todo da classe <code>Conta</code> mesmo. Esse novo atributo nos permite descobrir esse erro com mais facilidade, exibindo uma mensagem de erro bastante clara:</p>

<pre><code class="php">&lt;?php
class Conta
{
    public function saca(int $valor): void { /* implementa√ß√£o */ }
}

class ContaCorrente
{
    #[Override]
    public function sacar(int $valor): void { /* implementa√ß√£o modificada */ }
}
</code></pre>

<p>Isso geraria o seguinte erro:</p>

<blockquote>
  <p>Fatal error: ContaCorrente::sacar() has #[\Override] attribute, but no matching parent method exists</p>
</blockquote>

<p>Essa √© mais uma novidade do PHP 8.3 sobre a qual eu gravei um v√≠deo espec√≠fico em meu canal do YouTube. Aqui voc√™ pode confer√≠-lo:</p>

<p><lite-youtube videoid="OO2fMqTAwZE">
    <a href="https://youtube.com/watch?v=OO2fMqTAwZE" class="lty-playbtn" title="Reproduzir v√≠deo">
        <span class="lyt-visually-hidden">
            Novidades do PHP 8.3 - Novo atributo (Override) para sobrescrita de m√©todos | Dias de Dev
        </span>
    </a>
</lite-youtube></p>

<h2 id="exce%C3%A7%C3%B5es-de-datetime-mais-adequadas-e-espec%C3%ADficas">Exce√ß√µes de DateTime mais adequadas e espec√≠ficas</h2>

<p>Algumas novas classes de exce√ß√£o s√£o introduzidas no PHP 8.3. Se tratando de <code>DateTime</code>, essas s√£o as novas exce√ß√µes:</p>

<ul>
<li><code>DateException</code>

<ul>
<li><code>DateInvalidOperationException</code></li>
<li><code>DateInvalidTimezoneException</code></li>
<li><code>DateMalformedIntervalStringException</code></li>
<li><code>DateMalformedPeriodStringException</code></li>
<li><code>DateMalformedStringException</code></li>
</ul></li>
<li><code>DateError</code>

<ul>
<li><code>DateObjectError</code></li>
<li><code>DateRangeError</code></li>
</ul></li>
</ul>

<p>Com isso, algumas exce√ß√µes lan√ßadas anteriormente ao instanciar objetos do tipo <code>DateTime</code>, <code>DateTimeImmutable</code>, <code>DateInterval</code> e <code>DatePeriod</code> podem ser diferentes agora. Um exemplo:</p>

<pre><code class="php">// At√© o PHP 8.2, uma exce√ß√£o do tipo `Exception` seria lan√ßada
// A partir do 8.3, `DateMalformedStringException` ser√° lan√ßada
new DateTime('data inv√°lida');
</code></pre>

<p>Essa √© uma <em>RFC</em> simples, mas com um grande n√∫mero de modifica√ß√µes. Se quiser saber mais sobre cada caso que pode lan√ßar uma das novas exce√ß√µes, voc√™ pode conferir a <a href="https://wiki.php.net/rfc/datetime-exceptions">p√°gina da <em>RFC</em></a>.</p>

<h2 id="nova-fun%C3%A7%C3%A3o-%60json_validate%60">Nova fun√ß√£o <code>json_validate</code></h2>

<p>Em alguns cen√°rios n√≥s precisamos garantir que uma <em>string</em> √© um <em>json</em> v√°lido, mas n√£o necessariamente precisamos realizar a transforma√ß√£o dessa <em>string</em> em um objeto ou <em>array</em> em PHP. Se n√≥s precisamos armazenar no banco de dados um <em>json</em> recebido na requisi√ß√£o, por exemplo, n√£o h√° necessidade de realizar todo o trabalho de transformar esse <em>json</em> com a fun√ß√£o <code>json_decode</code>.</p>

<p>Por√©m, at√© o PHP 8.2, a √∫nica forma de descobrirmos se uma <em>string</em> √© um <em>json</em> v√°lido em PHP era atrav√©s da fun√ß√£o <code>json_decode</code>. Esse desperd√≠cio de recursos foi resolvido no PHP 8.3 com a chegada da fun√ß√£o <code>json_validate</code>.</p>

<p>Essa nova fun√ß√£o garante que o <em>json</em> √© v√°lido, mas sem precisar alocar mem√≥ria para salvar seu conte√∫do transformado j√° que ela simplesmente retorna um booleano.</p>

<p>Eu gravei um v√≠deo curto no YouTube (no formato de <em>shorts</em>) falando sobre essa nova fun√ß√£o. Voc√™ pode conferir aqui:</p>

<p><lite-youtube videoid="7rnKavIf67w">
    <a href="https://youtube.com/watch?v=7rnKavIf67w" class="lty-playbtn" title="Reproduzir v√≠deo">
        <span class="lyt-visually-hidden">
            Novidades do PHP 8.3: Nova fun√ß√£o json_validate | Dias de Dev #shorts
        </span>
    </a>
</lite-youtube></p>

<h2 id="comando-%60php--l%60-agora-suporta-m%C3%BAltiplos-arquivos">Comando <code>php -l</code> agora suporta m√∫ltiplos arquivos</h2>

<p>Um comando muito √∫til √© o <code>php -l</code> que permite verificar se um arquivo possui algum erro de sintaxe. At√© a vers√£o 8.2 do PHP apenas um arquivo podia ser analisado por vez. Agora, a partir do PHP 8.3, n√≥s podemos passar diversos arquivos para o <code>php -l</code> analisar. Exemplo:</p>

<pre><code class="shell">php -l arquivo1.php arquivo2.php
</code></pre>

<p>O comando exibir√°, caso nenhum dos arquivos possua erros de sintaxe:</p>

<blockquote>
  <p>No syntax errors detected in arquivo1.php</p>
  
  <p>No syntax errors detected in arquivo2.php</p>
</blockquote>

<h2 id="fun%C3%A7%C3%B5es-array_sum-e-array_product-mais-consistentes">Fun√ß√µes array_sum e array_product mais consistentes</h2>

<p>As fun√ß√µes <code>array_sum</code> e <code>array_product</code> possuiam um comportamento menos previs√≠vel quando valores n√£o num√©ricos eram encontrados nos arrays a serem processados. Essa novidade traz uma maior consist√™ncia e previsibilidade para seu comportamento.</p>

<p>Por exemplo:</p>

<pre><code class="php">$input = [true, STDERR, new stdClass(), []];
var_dump(array_sum($input));
var_dump(array_product($input));
</code></pre>

<p>Tanto at√© o PHP 8.2 quanto no PHP 8.3, os resultados ser√£o 4 e 3, por√©m no PHP 8.3 diversos alertas ser√£o exibidos informando que n√£o √© poss√≠vel realizar opera√ß√µes matem√°ticas em <code>resource</code>, em <code>stdClass</code> e em <code>array</code> (<code>true</code> vira 1 em opera√ß√µes matem√°ticas no PHP e isso n√£o muda nessa vers√£o).</p>

<p>Isso faz com que n√≥s sejamos notificados pela aplica√ß√£o caso opera√ß√µes matem√°ticas estejam sendo realizadas onde n√£o deveriam.</p>

<p>H√° mais pontos de melhoria trazidos por essa <em>RFC</em> e por isso eu tamb√©m tenho um v√≠deo completo sobre ela:</p>

<p><lite-youtube videoid="cpJAwte1xZU">
    <a href="https://youtube.com/watch?v=cpJAwte1xZU" class="lty-playbtn" title="Reproduzir v√≠deo">
        <span class="lyt-visually-hidden">
            Novidades do PHP 8.3 - Fun√ß√µes array_sum e array_product mais consistentes | Dias de Dev
        </span>
    </a>
</lite-youtube></p>

<h2 id="mais-novidades">Mais novidades</h2>

<p>Voc√™ j√° deve ter reparado que esse post come√ßou a ficar bem grande, n√£o √© mesmo? O PHP 8.3 realmente est√° trazendo algumas novidades bem interessantes e nesse post eu quis destacar algumas delas.</p>

<p>Mas se voc√™ quiser saber sobre <strong>todas</strong> as novidades que o PHP 8.3 traz, pode conferir a <a href="https://wiki.php.net/rfc#php_83">p√°gina oficial das <em>RFCs</em></a> ou conferir a seguinte lista:</p>

<ul>
<li><a href="https://wiki.php.net/rfc/deprecations_php_8_3">Descontinua√ß√µes do PHP 8.3</a></li>
<li><a href="https://wiki.php.net/rfc/saner-inc-dec-operators">Modifica√ß√µes nos operadores de incremento e decremento</a></li>
<li><a href="https://wiki.php.net/rfc/arbitrary_static_variable_initializers">Possibilidade de usar express√µes em vari√°veis est√°ticas</a></li>
<li><a href="https://wiki.php.net/rfc/unserialize_warn_on_trailing_data">Aviso quando <code>unserialize()</code> encontrar dados remanescentes</a></li>
<li><a href="https://www.youtube.com/watch?v=h3dZlJrpvi0">Acesso din√¢mico a constantes de classes</a></li>
<li><a href="https://wiki.php.net/rfc/improve_unserialize_error_handling">Melhoria de tratativa de erros da fun√ß√£o <code>unserialize()</code></a></li>
<li><a href="https://wiki.php.net/rfc/assert-string-eval-cleanup">Descontinua√ß√µes relacionadas √†s fun√ß√µes de <code>assert</code></a></li>
<li><a href="https://wiki.php.net/rfc/mb_str_pad">Nova fun√ß√£o mb_str_pad</a></li>
<li><a href="https://wiki.php.net/rfc/proper-range-semantics">Melhor defini√ß√£o da sem√¢ntica da fun√ß√£o <code>range()</code></a></li>
<li><a href="https://wiki.php.net/rfc/randomizer_additions">Adi√ß√µes √† extens√£o de aleatoriedade (<code>Randomizer</code>)</a></li>
<li><a href="https://wiki.php.net/rfc/sqlite3_exceptions">Utilizar exce√ß√µes por padr√£o na extens√£o <code>SQLite3</code></a></li>
<li><a href="https://wiki.php.net/rfc/deprecate_functions_with_overloaded_signatures">Descontinuar fun√ß√µes com sobrecarga</a></li>
</ul>

<p>E se voc√™ quiser aprender mais sobre PHP e suas funcionalidades, vou deixar aqui um <a href="https://tidd.ly/4d42Myb">cupom de desconto para a Alura</a>, onde eu tenho diversos cursos sobre PHP, dentre outros assuntos.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Explorando M√©todos M√°gicos no PHP: Conceitos e Exemplos Pr√°ticos]]></title>
            <link href="https://dias.dev/2023-08-11-metodos-magicos-php/"/>
            <updated>2023-08-11T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-08-11-metodos-magicos-php/</id>
            <content type="html"><![CDATA[<p>Os m√©todos m√°gicos no PHP s√£o m√©todos "especiais" que s√£o invocadas implicitamente quando certas a√ß√µes ocorrem. Neste post, exploraremos esses m√©todos, como eles funcionam e como podem ser √∫teis.</p>

<h3 id="m%C3%A9todos-m%C3%A1gicos%3A-uma-vis%C3%A3o-geral">M√©todos m√°gicos: Uma vis√£o geral</h3>

<p>PHP √© uma linguagem de programa√ß√£o que suporta, dentre outros, o paradigma de programa√ß√£o orientada a objetos. Sendo assim, podemos definir m√©todos dentro das nossas classes, ou seja, fun√ß√µes que operam no contexto de um objeto. M√©todos m√°gicos s√£o aqueles que podemos definir em nosso c√≥digo e s√£o acionados automaticamente pelo PHP em situa√ß√µes espec√≠ficas.</p>

<p>Alguns exemplos de quando os m√©todos m√°gicos podem ser acionados incluem tentativas de acesso a membros inexistentes ou inacess√≠veis de uma classe, convers√µes de objetos e verifica√ß√µes especiais.</p>

<h2 id="exemplo-pr%C3%A1tico">Exemplo pr√°tico</h2>

<p>Um exemplo claro dos m√©todos m√°gicos em a√ß√£o √© o caso do framework Laravel. Considere uma classe de modelo (<em>Model</em>) que lida com a persist√™ncia de um usu√°rio:</p>

<pre><code class="php">&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{ }
</code></pre>

<p>Apesar de n√£o definir nenhuma propriedade explicitamente, podemos atribuir valores a propriedades como se elas existissem:</p>

<pre><code class="php">&lt;?php

use App\Models\User;

$user = new User();
$user-&gt;name = 'Vinicius Dias';
$user-&gt;email = 'email@example.com';
$user-&gt;save();
</code></pre>

<p>O m√©todo <code>save</code> √© entendido como parte da classe base <code>Model</code>, mas e quanto √†s propriedades? Para cen√°rios como esse, os m√©todos m√°gicos foram concebidos.</p>

<h2 id="implementa%C3%A7%C3%A3o-de-m%C3%A9todos-m%C3%A1gicos">Implementa√ß√£o de m√©todos m√°gicos</h2>

<p>O nome de todo m√©todo m√°gico no PHP come√ßa com dois underscores (<code>__</code>). Por exemplo, o m√©todo <code>__set</code> √© invocado quando tentamos atribuir um valor a uma propriedade inexistente ou inacess√≠vel. Ele recebe o nome da propriedade e o valor como par√¢metros:</p>

<pre><code class="php">&lt;?php

class NossaModel
{
    /**
     * @var array&lt;string, mixed&gt; Array associativo contendo todos os valores que definirmos
     */
    private array $atributos;

    /**
     * @param string $name Nome da propriedade inacess√≠vel que estamos tentando definir
     * @param mixed $value Valor que estamos tentando atribuir a essa propriedade
     * @return void
     */
    public function __set(string $name, mixed $value): void
    {
        /*
         * Aqui, se fizermos $model-&gt;teste = 'Valor', criaremos a chave 'teste'
         * na propriedade $atributos com o valor 'Valor'
         */
        $this-&gt;atributos[$name] = $value;
    }
}
</code></pre>

<p>Repare que o c√≥digo que escrevemos no m√©todo √© c√≥digo PHP como qualquer outro. Ali n√≥s poder√≠amos realizar qualquer tipo de l√≥gica.</p>

<h3 id="como-acessar-esse-valor%3F">Como acessar esse valor?</h3>

<p>Aprendemos a definir um valor a partir de uma propriedade inexistente, mas se tentarmos ler esse valor, receberemos um erro. O c√≥digo a seguir, por exemplo, falha:</p>

<pre><code class="php">$teste = new NossaModel();
$teste-&gt;nome = 'Vinicius';

/*
 * Na linha a seguir, o retorno ser√° nulo e um _Warning_ ser√° emitido
 * dizendo que a propriedade NossaModel::$nome n√£o existe.
 */
echo $teste-&gt;nome;
</code></pre>

<p>Para escrever em propriedades inexistentes, usamos o <code>__set</code>. J√° para ler de propriedades inexistentes ou inacess√≠veis, utilizamos o m√©todo <code>__get</code>. Ent√£o poder√≠amos ter o seguinte m√©todo na classe <code>NossaModel</code>:</p>

<pre><code class="php">/**
 * @param string $name Nome da propriedade inexistente que estamos tentando ler
 * @return mixed Aqui devemos retornar o valor que corresponder√° a essa propriedade 
 */
public function __get(string $name): mixed
{
    // O valor retornado pelo m√©todo __get √© utilizado onde tentamos acessar a propriedade 
    return $this-&gt;atributos[$name];
}
</code></pre>

<p>Com isso, o c√≥digo a seguir funcionaria sem problemas:</p>

<pre><code class="php">$teste = new NossaModel();
// Chamada impl√≠cita a $teste-&gt;__set('nome', 'Vinicius');
$teste-&gt;nome = 'Vinicius';

// Chamada impl√≠cita a $teste-&gt;__get('nome'), que vai retornar 'Vinicius'
echo $teste-&gt;nome;
</code></pre>

<h2 id="mais-m%C3%A9todos">Mais m√©todos</h2>

<p>At√© aqui n√≥s citamos apenas 2 m√©todos m√°gicos, mas o PHP fornece diversos outros. Vou deixar a seguir uma lista deles:</p>

<h3 id="construtor-e-destrutor">Construtor e destrutor</h3>

<p>O m√©todo construtor, chamado de <code>__construct</code>, √© executado quando criamos um novo objeto (utilizando <code>new</code>). Normalmente utilizamos o m√©todo construtor para receber depend√™ncias e inicializar as propriedades.</p>

<p>J√° o m√©todo destrutor, <code>__destruct</code>, √© executado quando um objeto sai de escopo ou quando o objeto √© passado para a fun√ß√£o <code>unset</code>. Normalmente ele √© utilizado para liberar recursos que tenham sido alocados no construtor, como fechar arquivos, conex√µes, etc. Com a natureza <em>stateless</em> do PHP, esse m√©todo n√£o √© t√£o utilizado.</p>

<h3 id="convers%C3%B5es">Convers√µes</h3>

<p>Em alguns cen√°rios n√≥s podemos querer utilizar nossos objetos como um tipo diferente. Se quisermos usar nosso objeto como uma string, por exemplo, podemos utilizar o m√©todo <code>__toString</code>. O que n√≥s retornarmos nesse m√©todo √© utilizado se nosso objeto for convertido para string de forma impl√≠cita ou expl√≠cita. Objetos de resposta HTTP, por exemplo, geralmente implementam esse m√©todo retornando o corpo da resposta.</p>

<pre><code class="php">&lt;?php

class Response
{
    private string $body;
    // Outras propriedades

    public function __toString() : string
    {
        return $this-&gt;body;
    }
}

$response = new Response();
// Defini√ß√£o dos valores

echo $response; // Isso usa o objeto como string, logo, chama o __toString
</code></pre>

<p>H√° tamb√©m casos onde queremos utilizar nosso objeto como se ele fosse uma fun√ß√£o. Para isso existe o m√©todo <code>__invoke</code>. Se n√≥s passarmos nosso objeto por par√¢metro em algum lugar que espera um <code>callable</code>, o m√©todo <code>__invoke</code> ser√° executado. Exemplo:</p>

<pre><code class="php">&lt;?php

class ControllerDeExemplo
{
    public function __invoke(int $parametro1, string $parametro2): void
    {
        // Execu√ß√£o de exemplo
    }
}

$controller = new ControllerDeExemplo();

$controller(1, 'Teste'); // Isso executar√° o m√©todo __invoke
</code></pre>

<h3 id="chamada-de-m%C3%A9todos">Chamada de m√©todos</h3>

<p>Assim como n√≥s podemos acessar propriedades inexistentes (ou inacess√≠veis) com m√©todos m√°gicos, o mesmo serve para m√©todos. Se voc√™ tentar chamar um m√©todo n√£o existente de um objeto, o m√©todo <code>__call</code> ser√° executado, recebendo o nome do m√©todo que tentou ser executado e todos os seus par√¢metros. J√° o <code>__callStatic</code> funciona da mesma forma, mas caso um m√©todo <strong>est√°tico</strong> inexistente seja chamado a partir de uma classe.</p>

<pre><code class="php">class Exemplo
{
    public function __call(string $name, array $arguments): mixed
    {
        /*
         * $name possui o nome do m√©todo inexistente que foi executado,
         * enquanto $arguments possui todos os par√¢metros que foram passados para esse m√©todo
         */
    }

    public static function __callStatic(string $name, array $arguments): mixed
    {
        // Equivalente est√°tico ao __call
    }
}

// Chama implicitamente Exemplo::__callStatic('qualquerCoisa', [1, 2]):
Exemplo::qualquerCoisa(1, 2);

$objeto = new Exemplo();

// Chama implicitamente $objeto-&gt;__call('qualquerCoisa', [1, 2]):
$objeto-&gt;qualquerCoisa(1, 2);
</code></pre>

<h3 id="restante-dos-m%C3%A9todos">Restante dos m√©todos</h3>

<p>Para que esse post n√£o fique ainda maior, vou deixar a seguir uma lista dos demais m√©todos m√°gicos com uma breve descri√ß√£o, mas caso voc√™ queira ver mais exemplos e detalhes, pode conferir a <a href="https://www.php.net/manual/en/language.oop5.magic.php">documenta√ß√£o do PHP</a>.</p>

<ul>
<li><code>__isset</code>: M√©todo executado caso passemos alguma propriedade inacess√≠vel do nosso objeto para a fun√ß√£o <code>isset</code> ou <code>empty</code>;</li>
<li><code>__unset</code>: M√©todo executado caso passemos alguma propriedade inacess√≠vel do nosso objeto para a fun√ß√£o <code>unset</code>;</li>
<li><code>__sleep</code>: Ao chamar a fun√ß√£o <code>serialize</code> passando nosso objeto, esse m√©todo √© executado <strong>antes</strong> da serializa√ß√£o. Seu retorno deve ser um array contendo os nomes das propriedades do objeto em quest√£o que ser√£o serializadas. Normalmente √© utilizado para remover propriedades que n√£o devem ser serializadas com conex√µes com o banco, arquivos abertos, etc;</li>
<li><code>__wakeup</code>: Esse m√©todo n√£o recebe par√¢metros e √© executado <strong>ap√≥s</strong> um dado ser desserializado e o objeto ser criado. Esse m√©todo geralmente reconstr√≥i os recursos como conex√µes com o banco;</li>
<li><code>__serialize</code>: Similar ao <code>__sleep</code>. Se ambos estiverem definidos, apenas <code>__serialize</code> √© chamado e <code>__sleep</code> √© ignorado. A diferen√ßa √© que o <code>__serialize</code> deve retornar um array associativo que ser√° serializado ao inv√©s de retornar os nomes das propriedades do objeto;</li>
<li><code>__unserialize</code>: Similar ao <code>__wakeup</code>. Se ambos estiverem definidos, apenas <code>__unserialize</code> √© chamado e <code>__wakeup</code> √© ignorado. <code>__unserialize</code> recebe por par√¢metro o array que foi serializado e com isso, deve reconstruir o objeto;</li>
<li><code>static __set_state</code>: Esse m√©todo √© o mais raro. Ele √© utilizado para criar um objeto da classe em quest√£o a partir da fun√ß√£o <code>var_export</code>;</li>
<li><code>__clone</code>: M√©todo chamado quando um clone de um objeto √© criado. <code>$this</code> nesse m√©todo vai se referir ao novo objeto criado. Normalmente esse m√©todo √© definido para evitar <em>shallow copies</em> e realizar os clones de todas as propriedades tamb√©m;</li>
<li><code>__debugInfo</code>: O retorno desse m√©todo deve conter os dados que ser√£o exibidos pela fun√ß√£o <code>var_dump</code>. Geralmente √© um array associativo;</li>
</ul>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>O PHP possui um grande n√∫mero de m√©todos m√°gicos. Alguns s√£o bastante f√°ceis de entender como <code>__get</code>, <code>__set</code> e <code>__call</code>, enquanto outros s√£o mais confusos como as diferen√ßas entre <code>__sleep</code> e <code>__serialize</code>. H√° ainda aqueles bem pouco usados como o <code>__set_state</code>.</p>

<p>Lembrar de todos os m√©todos (e suas assinaturas) e o que cada um deles faz n√£o √© necess√°rio, mas √© importante saber da exist√™ncia deles para saber o que pesquisar quando for necess√°rio.</p>

<p>Se quiser aprender mais sobre PHP e sobre tecnologia em geral, vou deixar aqui um <a href="https://tidd.ly/4d42Myb">cupom de 15% de desconto na Alura</a>, plataforma onde eu gravei in√∫meros cursos.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Como remover acentos de palavras com PHP]]></title>
            <link href="https://dias.dev/2023-08-01-como-remover-acentos-de-palavras-com-php/"/>
            <updated>2023-08-01T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-08-01-como-remover-acentos-de-palavras-com-php/</id>
            <content type="html"><![CDATA[<p><em>Edit: <a href="https://www.linkedin.com/feed/update/urn:li:activity:7092531957842026499?commentUrn=urn%3Ali%3Acomment%3A%28activity%3A7092531957842026499%2C7092591873462038528%29">Neste coment√°rio</a> o Wanderson me apontou outra solu√ß√£o para resolver o mesmo problema, ent√£o estou adicionando-a ao in√≠cio do post.</em></p>

<h2 id="extens%C3%A3o-iconv">Extens√£o iconv</h2>

<pre><code class="php">&lt;?php

$string = '√É√©√Ø√≤√ª';
echo iconv('UTF-8', 'ASCII//TRANSLIT', $string); // Exibe: Aeiou
</code></pre>

<p>O c√≥digo PHP acima remove os acentos, logo, o texto <code>√É√©√Ø√≤√ª</code> vai se tornar <code>Aeiou</code>. Esse trabalho √© realizado pela <a href="/2022-02-13-extensoes-php/">extens√£o</a> <code>iconv</code> que vem instalada por padr√£o no PHP. Ela permite a convers√£o entre <em><a href="/2021-08-24-charsets-e-encodings-como-strings-funcionam/">encodings</a></em>.</p>

<p>Ao converter uma string para <em>ASCII</em>, n√≥s podemos escolher ignorar os caracteres n√£o existentes nesse <em>charset</em> ou realizar uma translitera√ß√£o (mapeamento) dos caracteres que n√£o fazem parte da tabela para o mais pr√≥ximo poss√≠vel. Para isso, adicionamos o sufixo <code>//TRANSLIT</code> ao segundo par√¢metro. Isso transforma, por exemplo, o caractere <code>√É</code> em <code>A</code>.</p>

<p>Essa abordagem vai funcionar na maioria dos cen√°rios, mas h√° algumas observa√ß√µes que devem ser consideradas.</p>

<h3 id="locale">Locale</h3>

<p>A convers√£o com <code>iconv</code> n√£o vai funcionar caso a categoria <code>LC_CTYPE</code> do <code>locale</code> esteja definida como <code>C</code> ou <code>POSIX</code>.</p>

<p>Exemplo:</p>

<pre><code class="php">&lt;?php

setlocale(LC_CTYPE, 'POSIX');
echo iconv('UTF-8', 'ASCII//TRANSLIT', '√É√©√Ø√≤√ª'); // Exibe ?????
</code></pre>

<h3 id="implementa%C3%A7%C3%A3o-do-iconv">Implementa√ß√£o do iconv</h3>

<p>Outro problema √© que o sufixo <code>//TRANSLIT</code> tem seu funcionamento dependente da implementa√ß√£o do <code>iconv</code> que seu sistema operacional possui. Algumas implementa√ß√µes s√£o conhecidas por ignorar <code>//TRANSLIT</code>, ent√£o a convers√£o provavelmente falhar√°.</p>

<p>Para esses cen√°rios uma de suas op√ß√µes √© instalar outra implementa√ß√£o do <code>iconv</code>. Voc√™ pode verificar qual a implementa√ß√£o do seu sistema operacional lendo o conte√∫do da constante <code>ICONV_IMPL</code>. A implementa√ß√£o <code>glibc</code> √© segura e funciona conforme exemplificado nesse post.</p>

<h3 id="solu%C3%A7%C3%A3o">Solu√ß√£o</h3>

<p>Caso voc√™, por algum motivo, n√£o possa alterar o <code>locale</code> em seu servidor e o padr√£o for <code>C</code> ou <code>POSIX</code>, a solu√ß√£o descrita n√£o √© v√°lida para seu caso. Se sua implementa√ß√£o do <code>iconv</code> no sistema operacional for uma incompat√≠vel com <code>//TRANSLIT</code> e voc√™ n√£o puder ou preferir n√£o instalar outra implementa√ß√£o, essa dica tamb√©m n√£o foi para voc√™.</p>

<p>Uma solu√ß√£o para os problemas previamente citados √© utilizar outra abordagem, com outra extens√£o. Para estes raros cen√°rios, deixo a seguir o conte√∫do original desse post, onde mostro como utilizar a normaliza√ß√£o de strings com PHP para remover acentos.</p>

<h2 id="post-original">Post original</h2>

<p>Remover acentos de palavras usando PHP √© uma tarefa bastante comum, principalmente para gerar <em>slugs</em> ou links amig√°veis. Nesse texto n√≥s vamos aprender a utilizar a extens√£o <em>intl</em> para realizar essa tarefa com 2 simples linhas de c√≥digo.</p>

<h3 id="tl%3Bdr-me-mostre-logo-o-c%C3%B3digo">TL;DR Me mostre logo o c√≥digo</h3>

<pre><code class="php">&lt;?php

$string = '√É√©√Ø√≤√ª';

$normalized = Normalizer::normalize($string, Normalizer::NFD);
echo preg_replace('/[\x{0300}-\x{036F}]/u', '', $normalized); // Exibe: Aeiou

</code></pre>

<p>O c√≥digo PHP acima remove os acentos, logo, o texto <code>√É√©√Ø√≤√ª</code> vai se tornar <code>Aeiou</code>. Agora vamos entender o que o c√≥digo faz.</p>

<h2 id="normaliza%C3%A7%C3%A3o-de-texto">Normaliza√ß√£o de texto</h2>

<p>A primeira parte desse simples algoritmo consiste em <strong>normalizar</strong> o texto. Normalizar um texto consiste em transform√°-lo de alguma forma pr√©-determinada, seguindo algumas normas ou regras.</p>

<p>O c√≥digo acima pega a string <code>"√É√©√Ø√≤√ª"</code> e a normaliza utilizando a forma de normaliza√ß√£o D (<code>NFD</code>), conhecida tamb√©m como decomposi√ß√£o can√¥nica (<em>Canonical Decomposition</em>). Essa regra consiste em separar os caracteres de acentua√ß√£o dos demais, ou seja, caracteres como crase (&#96;) ou til (~) s√£o separados das letras. O caractere <code>√É</code>, por exemplo, se torna <code>A~</code>.</p>

<p>Essa forma de normaliza√ß√£o foi definida e nomeada pelo <a href="/2021-08-24-charsets-e-encodings-como-strings-funcionam/"><em>Unicode Consortium</em></a>, mas n√£o √© a √∫nica. Voc√™ pode conferir mais detalhes sobre cada uma das "regras" no site oficial: <a href="https://unicode.org/reports/tr15/">https://unicode.org/reports/tr15/</a>.</p>

<h3 id="extens%C3%A3o-php">Extens√£o PHP</h3>

<p>Tendo entendido o que √© normalizar um texto, como √© poss√≠vel atingir esse objetivo com PHP? Atrav√©s de uma <a href="/2022-02-13-extensoes-php/">extens√£o</a> externa chamada <code>intl</code>.</p>

<p>Essa extens√£o fornece acesso a uma biblioteca famosa chamada <em>ICU (International Components for Unicode)</em>, que traz diversas opera√ß√µes referentes a <em>locale</em>. O termo <em>locale</em> em ingl√™s n√£o tem uma boa tradu√ß√£o (pelo menos eu n√£o conhe√ßo), mas basicamente se refere a informa√ß√µes como formatos de data e hora, moedas, textos, etc. Repare que n√£o √© apenas relacionado ao idioma, mas tudo que envolve formatos internacionais.</p>

<p>A extens√£o <code>intl</code> traz, dentre v√°rias outras, a classe <code>Normalizer</code> que tem como √∫nico prop√≥sito realizar a normaliza√ß√£o de textos. Com isso, o c√≥digo a seguir separa cada caractere de seu respectivo acento, caso haja algum:</p>

<pre><code class="php">$normalized = Normalizer::normalize('√É√©√Ø√≤√ª', Normalizer::NFD);
</code></pre>

<p>Isso vai devolver uma string com o conte√∫do semelhante ao seguinte: <code>A~e¬¥i¬®o`u^</code>. "Semelhante" porque os caracteres individuais e separados de acentos (como o <code>^</code>) n√£o s√£o os mesmos que vemos quando s√£o adicionados a uma letra, ent√£o o real caractere n√£o vai ser vis√≠vel de forma individual ao tentar exibir a string resultante. Mas n√≥s n√£o queremos exibir a string normalizada, e sim manipul√°-la. E √© justamente sobre essa manipula√ß√£o que vamos falar agora.</p>

<h2 id="express%C3%A3o-regular">Express√£o regular</h2>

<p>Ap√≥s separar os caracteres de seus respectivos acentos, a tarefa de remover os acentos se torna bastante simples. Basta utilizarmos uma express√£o regular (a temida <em>regex</em>) para remover qualquer caractere que seja um acento. Os caracteres com c√≥digo <em>Unicode</em> entre U+0300 e U+036F s√£o acentos, logo, podemos remov√™-los com o seguinte c√≥digo:</p>

<pre><code class="php">preg_replace('/[\x{0300}-\x{036F}]/u', '', $normalized);
</code></pre>

<p>O modificador <code>/u</code>, ao final da <em>regex</em>, indica ao PHP que estamos trabalhando com UTF-8 nessa express√£o regular, o que nos permite utilizar <code>\x</code>, que √© o que nos d√° o poder de identificar os caracteres <em>Unicode</em>.</p>

<p>Isso garante n√£o haver altera√ß√£o da string original, mantendo n√∫meros, caracteres especiais, etc. Claro que voc√™ pode mudar a express√£o regular para remover tudo que n√£o sejam letras, n√∫meros e espa√ßos, por exemplo. O c√≥digo ficaria assim:</p>

<pre><code class="php">preg_replace('/[^a-zA-Z0-9\s]/', '', $normalized);
</code></pre>

<p>O c√≥digo acima √© geralmente utilizado para gerar URLs amig√°veis, ou os famosos <em>slugs</em>. Mas ap√≥s entender o processo de normaliza√ß√£o, modificar a <em>regex</em> para atingir objetivos diferentes e mais espec√≠ficos se torna uma tarefa trivial.</p>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>Embora seja uma tarefa bastante comum, remover acentos com PHP pode n√£o parecer t√£o f√°cil quando uma r√°pida pesquisa √© feita na internet. Diversas listas enormes de caracteres a serem substitu√≠dos s√£o sugeridas, dentre outras pr√°ticas ainda mais "question√°veis".</p>

<p>O simples uso de uma extens√£o apropriada faz com que essa complexa tarefa seja imensamente facilitada. Recomendo acessar os links que deixei durante o post como refer√™ncia para se aprofundar em cada um dos assuntos aqui abordados.</p>

<p>J√° no link a seguir eu deixo um <a href="https://tidd.ly/4d42Myb">cupom de 15% de desconto</a> para voc√™ assinar a Alura, plataforma onde h√° cursos completos (alguns comigo, inclusive) sobre manipula√ß√£o de strings (dentre v√°rios outros assuntos de tecnologia).</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Strings multibyte: o que s√£o e por que voc√™ precisa da extens√£o mbstring do PHP]]></title>
            <link href="https://dias.dev/2023-03-21-strings-multibyte-php-mbstring/"/>
            <updated>2023-03-21T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-03-21-strings-multibyte-php-mbstring/</id>
            <content type="html"><![CDATA[<p><em>Strings multibyte</em> s√£o textos que possuem alguns caracteres que demandam mais de um <em>byte</em> para serem representados. H√° um post aqui no blog onde n√≥s falamos sobre <a href="/2021-08-24-charsets-e-encodings-como-strings-funcionam/">Charsets e Encodings: Como strings funcionam</a>. Agora n√≥s vamos entender como lidar com <em>strings multibyte</em> em PHP usando a <a href="/2022-02-13-extensoes-php/">extens√£o</a> <code>mbstring</code>.</p>

<h2 id="opera%C3%A7%C3%B5es-em-strings">Opera√ß√µes em strings</h2>

<p>Quando trabalhamos com textos, √© bastante comum precisarmos realizar algumas opera√ß√µes. Transformar todas as letras em mai√∫sculas ou min√∫sculas, por exemplo, √© uma opera√ß√£o corriqueira. At√© opera√ß√µes mais simples como contar o n√∫mero de caracteres podem nos trazer algumas dores de cabe√ßa se estivermos trabalhando com <em>strings multibyte</em>.</p>

<p>Um exemplo bastante simples:</p>

<pre><code class="php">&lt;?php

echo strlen('Ol√°'); // Exibe 4
echo strtoupper('ol√°'); // Exibe "OL√°"
</code></pre>

<h2 id="strings-multibyte">Strings multibyte</h2>

<p>Como foi exposto logo na introdu√ß√£o do post, uma <em>string multibyte</em> √© um texto que possui caracteres que demandam mais de um <em>byte</em> para serem representados. Caracteres com acento s√£o um √≥timo exemplo desse cen√°rio. √â necess√°rio mais de um <em>byte</em> para represent√°-los, j√° que em um √∫nico <em>byte</em> n√≥s conseguimos representar apenas 256 caracteres, que s√£o, n√£o coincidentemente, os caracteres da tabela <em>ASCII</em>.</p>

<p>As fun√ß√µes padr√£o de <em>strings</em> do PHP lidam assumindo que cada caractere da <em>string</em> possui um <em>byte</em>, por isso a contagem de caracteres √© inv√°lida com <code>strlen</code> e por isso que <strong>fun√ß√µes como <code>strtoupper</code> ou <code>strtolower</code> n√£o conseguem modificar os caracteres acentuados</strong>.</p>

<h2 id="extens%C3%A3o-mbstring">Extens√£o mbstring</h2>

<p>Como n√≥s cotidianamente trabalhamos com <em>strings</em> que contenham caracteres fora da tabela <em>ASCII</em>, obviamente o PHP n√£o nos deixaria desamparados nessa situa√ß√£o. Para realizar opera√ß√µes em <em>strings multibyte</em> n√≥s podemos usar a extens√£o <code>mbstring</code>. N√≥s j√° falamos sobre <a href="/2022-02-13-extensoes-php/">extens√µes PHP</a> aqui no blog, ent√£o vou partir do princ√≠pio que voc√™ j√° possui familiaridade com o assunto.</p>

<p>A extens√£o <code>mbstring</code> nos fornece diversas fun√ß√µes que possibilitam a manipula√ß√£o de <em>strings multibyte</em>, indo de opera√ß√µes simples como contar o n√∫mero de caracteres de uma string at√© opera√ß√µes mais complexas como <strong>converter o encoding de uma string</strong>.</p>

<p>A maioria das fun√ß√µes "padr√£o" de <em>strings</em> do PHP possui uma contraparte na <code>mbstring</code>, sendo apenas prefixada com <code>mb_</code>. O exemplo de c√≥digo anteriormente exposto que nos gerava o resultado inesperado poderia ser escrito da seguinte forma:</p>

<pre><code class="php">&lt;?php

echo mb_strlen('Ol√°'); // Exibe 3
echo mb_strtoupper('ol√°'); // Exibe "OL√Å"
</code></pre>

<p>Al√©m disso, se eu possuo uma <em>string</em> que est√° no <em>encoding</em> <code>ISO-8859-1</code> ou <code>WINDOWS-1252</code>, eu posso converter facilmente para UTF-8 com o seguinte c√≥digo:</p>

<pre><code class="php"><br />echo mb_convert_encoding('string em ISO-8859-1', 'UTF-8', 'ISO-8859-1');
</code></pre>

<h2 id="%60utf8_encode%60-e-%60utf8_decode%60"><code>utf8_encode</code> e <code>utf8_decode</code></h2>

<p>Quem me acompanha j√° sabe que as fun√ß√µes <code>utf8_encode</code> e <code>utf8_decode</code> ser√£o marcadas como <strong>obsoletas</strong> no PHP 8.2. Quem ainda n√£o sabia disso pode conferir o v√≠deo a seguir:</p>

<p><lite-youtube videoid="al47Lz_SWLc" style="background-image: url('https://i.ytimg.com/vi/al47Lz_SWLc/hqdefault.jpg');">
    <a href="https://youtube.com/watch?v=al47Lz_SWLc" class="lty-playbtn" title="Reproduzir v√≠deo">
        <span class="lyt-visually-hidden">Novidades do PHP 8.2: Descontinua√ß√£o de utf8_encode e utf8_decode | Dias de Dev</span>
    </a>
</lite-youtube></p>

<p>Como foi explicado no v√≠deo, essas fun√ß√µes ser√£o descontinuadas j√° que s√£o confusas e o uso de <code>mbstring</code> √© uma op√ß√£o v√°lida para chegar ao mesmo resultado. A seguir voc√™ pode conferir como seria realizada a convers√£o das <em>strings</em> sem as famosas fun√ß√µes de <code>utf8_</code>:</p>

<pre><code class="php">&lt;?php

// Equivalente a utf8_encode('string em ISO-8859-1');
echo mb_convert_encoding('string em ISO-8859-1', 'UTF-8', 'ISO-8859-1');

// Equivalente a utf8_decode('string em UTF-8');
echo mb_convert_encoding('string em UTF-8', 'ISO-8859-1', 'UTF-8');
</code></pre>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>Tendo entendido o conceito de <em>strings multibyte</em>, fica bastante claro tanto o papel da extens√£o <code>mbstring</code> quanto v√°rios problemas que n√≥s j√° enfrentamos ao manipular caracteres acentuados, por exemplo.</p>

<p>Se voc√™ quiser aprender mais sobre manipula√ß√µes de strings, encodings, charsets, PHP e mais assuntos relacionados a tecnologia, aqui est√° um <a href="https://tidd.ly/4d42Myb">cupom de desconto</a> para assinar a Alura, plataforma de cursos online onde eu sou o instrutor da maioria dos cursos de PHP.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Entenda o erro &quot;Cannot modify header information - headers already sent&quot; no PHP]]></title>
            <link href="https://dias.dev/2023-03-07-entenda-o-erro-cannot-modify-header-information-php/"/>
            <updated>2023-03-07T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-03-07-entenda-o-erro-cannot-modify-header-information-php/</id>
            <content type="html"><![CDATA[<p>O famoso erro do PHP com o texto "<em>Cannot modify header information - headers already sent</em>" acontece quando tentamos enviar um cabe√ßalho <em>HTTP</em> ap√≥s j√° termos enviado alguma sa√≠da no corpo da resposta. Nesse post n√≥s vamos entender o que isso tudo significa e como evitar esse problema em seu c√≥digo.</p>

<h2 id="_http_"><em>HTTP</em></h2>

<p><em>HTTP (HyperText Transfer Protocol)</em> √© o protocolo usado na internet, ent√£o sempre que voc√™ acessa um site usando seu navegador, por exemplo, <em>HTTP</em> est√° sendo usado.</p>

<p><em>HTTP</em> √© um protocolo que segue uma arquitetura cliente-servidor, onde h√° duas partes na comunica√ß√£o. De forma super simplificada: voc√™, usando seu navegador, √© o cliente. O site que voc√™ acessa √© o servidor.</p>

<p>Esse protocolo define mensagens de requisi√ß√£o (<em>request</em>) e resposta (<em>response</em>). Quando voc√™ acessa um site, seu navegador faz uma requisi√ß√£o para o servidor, que processa esse pedido e devolve uma resposta. Essas mensagens s√£o divididas em duas grandes partes: <strong>cabe√ßalhos</strong> e <strong>corpo</strong>.</p>

<p>O corpo de uma resposta, por exemplo, √© o conte√∫do que voc√™ v√™ na tela, enquanto cabe√ßalhos possuem informa√ß√µes adicionais como <a href="/2022-09-27-cookies-e-seguranca">cookies</a>, informa√ß√µes de redirecionamento, etc.</p>

<p>Esse √© um resumo bem conciso do protocolo <em>HTTP</em> e de <strong>como a internet funciona</strong>. Ainda sobre esse assunto, caso voc√™ tenha alguma d√∫vida ou queira entender melhor, eu tenho um v√≠deo no YouTube. Voc√™ pode confer√≠-lo antes de continuar lendo esse post:</p>

<p><lite-youtube videoid="B2IWlnJ_dt0" style="background-image: url('https://i.ytimg.com/vi/B2IWlnJ_dt0/hqdefault.jpg');">
  <a href="https://youtube.com/watch?v=B2IWlnJ_dt0" class="lty-playbtn" title="Reproduzir v√≠deo">
    <span class="lyt-visually-hidden">Play Video: Como funciona a Web? - A internet por baixo dos panos | Dias de Dev
</span>
  </a>
</lite-youtube></p>

<h2 id="como-o-php-funciona">Como o PHP funciona</h2>

<p>Entendido como a <em>web</em> funciona, √© hora de entender o que o <strong>PHP</strong> faz na <em>web</em>. Aqui no blog h√° um post sobre <a href="/2021-06-15-como-o-php-funciona-na-web">como o PHP funciona na Web</a> onde voc√™ pode entender como o <strong>PHP</strong> √© executado, mas aqui vou resumir o que voc√™ precisa saber para entender o problema de "<em>Cannot modify header information - headers already sent</em>".</p>

<p>Quando voc√™ exibe algo em PHP, seja atrav√©s de fun√ß√µes como <code>echo</code> ou at√© colocando <em>HTML</em> junto com seu PHP, esse conte√∫do √© enviado no corpo da resposta <em>HTTP</em> que o PHP gera. Isso tudo √© feito de forma transparente para n√≥s desenvolvedores.</p>

<p>Como foi citado no par√°grafo anterior, uma resposta <em>HTTP</em> √© dividida entre <strong>cabe√ßalhos</strong> e <strong>corpo</strong>, sendo que os cabe√ßalhos v√™m antes do corpo. Sendo assim, para n√≥s adicionarmos algo ao corpo da resposta com PHP, os cabe√ßalhos precisam ser montados e enviados antes.</p>

<p>Ent√£o quando voc√™, em um sistema <em>Web</em> feito em PHP, executa um <code>echo</code>, por exemplo, os cabe√ßalhos da resposta <em>HTTP</em> s√£o montados e enviados e depois o corpo √© enviado com o conte√∫do desse <code>echo</code>.</p>

<p>Existem tamb√©m fun√ß√µes no PHP que podem enviar ou modificar cabe√ßalhos. Algumas dessas fun√ß√µes s√£o:</p>

<ul>
<li><code>header</code></li>
<li><code>header_remove</code></li>
<li><code>session_start</code></li>
<li><code>setcookie</code></li>
<li>etc</li>
</ul>

<h2 id="entendendo-o-problema">Entendendo o problema</h2>

<p>Como foi dito logo na introdu√ß√£o desse <em>post</em>, o problema "<em>Cannot modify header information - headers already sent</em>" acontece quando tentamos enviar um cabe√ßalho <em>HTTP</em> ap√≥s j√° termos enviado algo no corpo da resposta.</p>

<p>Isso quer dizer que esse erro acontece quando n√≥s tentamos usar alguma fun√ß√£o que adiciona ou modifica cabe√ßalhos <em>HTTP</em> quando algum conte√∫do j√° foi exibido. Se voc√™ executar o seguinte c√≥digo em um contexto <em>web</em>, ver√° o erro em quest√£o:</p>

<pre><code class="php">&lt;?php

echo 'Corpo da resposta';

header('Location: /url-de-redirecionamento');
</code></pre>

<p>O que n√≥s estamos tentando fazer √© enviar o cabe√ßalho <code>Location</code>, mas o corpo da resposta j√° come√ßou a ser enviado quando n√≥s executamos <code>echo</code>, ou seja, os cabe√ßalhos j√° foram montados e enviados para o cliente.</p>

<h3 id="problema-acontecendo-mesmo-sem-echo-ou-html">Problema acontecendo mesmo sem echo ou HTML</h3>

<p>Voc√™ talvez esteja se perguntando o motivo de j√° ter se deparado com esse erro mesmo sem ter, antes de uma fun√ß√£o <code>header</code>, por exemplo, nenhuma exibi√ß√£o de conte√∫do. Sendo assim, teoricamente, nenhuma resposta deveria ter sido criada e os cabe√ßalhos ainda n√£o teriam sido enviados.</p>

<p>O que acontece √© que n√£o √© incomum que n√≥s geremos uma resposta mesmo sem querer. Se deixarmos espa√ßos em branco antes da <em>tag</em> de abertura do PHP (<code>&lt;?php</code>) ou ap√≥s a <em>tag</em> de fechamento do PHP (<code>?&gt;</code>), esses espa√ßos ser√£o exibidos e com isso os cabe√ßalhos ser√£o enviados. Outro caso <strong>muito comum</strong> √© se nossa aplica√ß√£o gerar algum aviso (os famosos <em>warnings</em> do PHP). Esses avisos sendo exibidos tamb√©m geram uma resposta e com isso, os cabe√ßalhos s√£o enviados.</p>

<h3 id="solu%C3%A7%C3%A3o">Solu√ß√£o</h3>

<p>Para que o erro n√£o ocorra mais, voc√™ precisa se certificar que qualquer fun√ß√£o que adiciona ou modifica cabe√ßalhos <em>HTTP</em> (como <code>header</code> ou <code>session_start</code>) seja executada antes que qualquer coisa seja exibida, mesmo que de forma acidental.</p>

<p>Para isso, voc√™ pode:</p>

<ol>
<li>Identificar e corrigir qualquer problema no c√≥digo que gere algum erro ou aviso;</li>
<li>Mover as fun√ß√µes que adicionam ou modificam cabe√ßalhos <em>HTTP</em> para o in√≠cio da execu√ß√£o de sua aplica√ß√£o, antes de qualquer exibi√ß√£o no corpo da resposta;</li>
<li><a href="/2023-02-24-php-ini-conhecendo-as-configuracoes-do-php">Configurar o PHP</a> para n√£o exibir os erros e avisos (Isso s√≥ deve ser feito em produ√ß√£o. Em ambiente de desenvolvimento precisamos ver e corrigir os avisos);</li>
<li>Evitar o uso da <em>tag</em> de fechamento do PHP (<code>?&gt;</code>) em arquivos que contenham apenas c√≥digo PHP;</li>
<li>Garantir que n√£o h√° espa√ßos antes da <em>tag</em> de abertura (<code>&lt;?php</code>) ou depois da tag de fechamento (<code>?&gt;</code>) do PHP.</li>
<li>Controlar o <a href="/2020-11-03-wraper-de-streams-php"><em>output buffer</em></a> do PHP, caso se depare com um caso mais espec√≠fico.</li>
</ol>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>Um dos erros mais conhecidos do mundo PHP, embora assustador, n√£o √© t√£o dif√≠cil de resolver. Com esse post voc√™ deve ter as informa√ß√µes necess√°rias para n√£o se deparar com ele novamente e para resolver o problema caso o encontre.</p>

<p>Caso queira se aprofundar e conhecer ainda mais nos estudos sobre PHP, aqui tem um <a href="https://tidd.ly/4d42Myb">cupom de desconto</a> para assinar a Alura, plataforma de cursos online onde eu sou o instrutor da maioria dos cursos de PHP.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[PHP.ini: Aprendendo a configurar o comportamento do PHP]]></title>
            <link href="https://dias.dev/2023-02-24-php-ini-conhecendo-as-configuracoes-do-php/"/>
            <updated>2023-02-24T00:00:00+00:00</updated>
            <id>https://dias.dev/2023-02-24-php-ini-conhecendo-as-configuracoes-do-php/</id>
            <content type="html"><![CDATA[<h2 id="o-que-%C3%A9-o-php.ini%3F">O que √© o php.ini?</h2>

<p>O arquivo <code>php.ini</code> √© o respons√°vel por conter as configura√ß√µes que afetam o comportamento do PHP onde ele for executado. O PHP l√™ as configura√ß√µes deste arquivo sempre que um novo processo √© iniciado.</p>

<h3 id="todas-as-configura%C3%A7%C3%B5es-em-um-%C3%BAnico-arquivo%3F">Todas as configura√ß√µes em um √∫nico arquivo?</h3>

<p>Entendido (mesmo que por alto) o que √© o <code>php.ini</code>, talvez voc√™ se pergunte: "mas todas as configura√ß√µes do PHP v√£o ficar em um √∫nico arquivo? Esse arquivo vai ser gigante!".</p>

<p>Esse questionamento √© muito v√°lido e a resposta √©: n√£o. N√£o √© necess√°rio manter todas as configura√ß√µes em um √∫nico arquivo. √â poss√≠vel ter em sua instala√ß√£o do PHP um diret√≥rio configurado onde outros arquivos de configura√ß√£o (no mesmo formato) ser√£o buscados e carregados.</p>

<h3 id="onde-encontrar-o-php.ini%3F">Onde encontrar o php.ini?</h3>

<p>A localiza√ß√£o do arquivo <code>php.ini</code> (e dos demais arquivos de configura√ß√£o) pode variar dependendo do sistema operacional e da forma como o PHP foi instalado, mas h√° um simples comando para te mostrar essa informa√ß√£o: <code>php --ini</code>. Executando esse comando voc√™ ter√° uma sa√≠da semelhante a seguinte:</p>

<pre><code>Configuration File (php.ini) Path: /etc/php/8.2/cli
Loaded Configuration File:         /etc/php/8.2/cli/php.ini
Scan for additional .ini files in: /etc/php/8.2/cli/conf.d
Additional .ini files parsed:      /etc/php/8.2/cli/conf.d/10-opcache.ini,
/etc/php/8.2/cli/conf.d/10-pdo.ini,
</code></pre>

<p>Repare que no exemplo acima, o arquivo "principal" √© o <code>php.ini</code> encontrado na pasta <code>/etc/php/8.2/cli</code>. Mas h√° tamb√©m a defini√ß√£o (feita no momento da compila√ß√£o do PHP) para buscar outros arquivos de configura√ß√£o na pasta <code>/etc/php/8.2/cli/conf.d</code>. L√° est√£o os arquivos <code>10-opcache.ini</code> e <code>10-pdo.ini</code>.</p>

<h4 id="prioridade-de-carregamento">Prioridade de carregamento</h4>

<p>Voc√™ deve ter notado que os arquivos "extra" de configura√ß√£o possuem um n√∫mero como prefixo (<code>10-opcache.ini</code> e <code>10-pdo.ini</code>). Esse n√∫mero <strong>n√£o</strong> tem um significado especial para o PHP, mas nos permite ordenar os arquivos por prioridade. O PHP vai carregar os arquivos <code>.ini</code> do diret√≥rio configurado em ordem alfabetica, sendo assim, n√∫meros s√£o adicionados para n√≥s podermos definir a prioridade de carregamento de cada arquivo. Quanto maior o n√∫mero, "mais depois" ele ser√° carregado, fazendo com que suas defini√ß√µes sejam aplicadas por √∫ltimo, sobrescrevendo as anteriores caso hajam configura√ß√µes duplicadas.</p>

<h2 id="o-que-pode-ser-configurado-pelo-php.ini">O que pode ser configurado pelo php.ini</h2>

<p>Existem muitas configura√ß√µes diferentes que podem ser definidas no arquivo <code>php.ini</code>. Algumas das configura√ß√µes mais comuns incluem:</p>

<ul>
<li>Configura√ß√µes de exibi√ß√£o de erros</li>
<li>Configura√ß√µes de seguran√ßa</li>
<li>Configura√ß√µes de desempenho</li>
<li>Configura√ß√µes de extens√µes</li>
</ul>

<h3 id="exemplos">Exemplos</h3>

<p>O formato <code>.ini</code> √© bastante simples e consiste em uma chave (o nome da configura√ß√£o) e um valor (o valor da configura√ß√£o) separados pelo sinal de igualdade (<code>=</code>). Al√©m disso, √© poss√≠vel adicionar coment√°rios colocando um ponto e v√≠rgula (<code>;</code>) em sua frente.</p>

<p>Sendo assim, para termos um arquivo <code>php.ini</code> dizendo que todos os erros devem ser exibidos, habilitando a <a href="/2022-09-27-cookies-e-seguranca/">configura√ß√£o <code>secure</code> do cookie de sess√£o</a>, tendo o <a href="https://youtube.com/watch?v=6vEspHqjrkI">opcache</a> habilitado e a <a href="/2022-02-13-extensoes-php/">extens√£o</a> <code>pdo_mysql</code> tamb√©m habilitada, n√≥s ter√≠amos o seguinte:</p>

<pre><code class="ini">; coment√°rio. O PHP n√£o vai ler essa linha
error_erporting=E_ALL
display_errors=1
session.cookie_secure=1
extension=pdo_mysql
opcache.enable=1
</code></pre>

<h3 id="configura%C3%A7%C3%B5es-poss%C3%ADvels">Configura√ß√µes poss√≠vels</h3>

<p>Voc√™ n√£o precisa tentar memorizar a lista de configura√ß√µes poss√≠veis, pois isso est√° dispon√≠vel na documenta√ß√£o do PHP. A documenta√ß√£o de cada <a href="/2022-02-13-extensoes-php/">extens√£o</a>, por exemplo, possui uma se√ß√£o de configura√ß√µes que mostra as poss√≠veis configura√ß√µes com a explica√ß√£o de cada um de seus valores.</p>

<h3 id="mais-detalhes-do-formato-ini">Mais detalhes do formato ini</h3>

<p>Antes de finalizar, voc√™ tamb√©m deve ter notado que em nosso exemplo, duas linhas possuem um ponto (<code>.</code>) no nome da configura√ß√£o e duas linhas n√£o. Geralmente as configura√ß√µes de <a href="/2022-02-13-extensoes-php/">extens√µes</a> s√£o nomeadas no formato <em>extensao.configuracao</em>, ou seja, a configura√ß√£o <code>enable</code> da extens√£o <code>opcache</code> se torna <code>opcache.enable</code>. J√° as configura√ß√µes que n√£o s√£o de uma extens√£o do PHP n√£o possuem esse ponto.</p>

<p>Um outro detalhe do formato <code>ini</code> s√£o suas <em>Sections</em>. Uma se√ß√£o √© identificada por um nome rodeado por colchetes. Ent√£o se eu quiser organizar meu arquivo e nomear uma se√ß√£o nele com todas as configura√ß√µes relacionadas a <a href="https://youtube.com/watch?v=6vEspHqjrkI">opcache</a>, eu poderia ter o seguinte:</p>

<pre><code class="ini">[opcache]
opcache.enable=1
opcache.validate_timestamps=0
; demais configura√ß√µes de opcache
</code></pre>

<p>Isso n√£o vai ter nenhum significado especial para o PHP, mas nos permite deixar o arquivo mais organizado para n√≥s lermos futuramente.</p>

<h4 id="se%C3%A7%C3%B5es-especiais-do-php.ini">Se√ß√µes especiais do php.ini</h4>

<p>Entendido o conceito de se√ß√µes do formato <code>ini</code>, h√° duas se√ß√µes especiais que podemos ter em nosso <code>php.ini</code>, chamadas <code>HOST</code> e <code>PATH</code>. Elas s√£o utilizadas para limitar configura√ß√µes que ser√£o carregadas em determinados endere√ßos web (<code>HOST</code>) ou em determinados caminhos de arquivos (<code>PATH</code>).</p>

<p>Para exibir todos os erros apenas em processos que respondem as requisi√ß√µes em <code>dev.example.com</code>, por exemplo, eu poderia ter o seguinte:</p>

<pre><code class="ini">[HOST=dev.example.com]
error_reporting=E_ALL
display_errors=1
</code></pre>

<p>Caso eu queira desabilitar o <a href="https://youtube.com/watch?v=6vEspHqjrkI">opcache</a> no projeto executado na pasta <code>/meu/projeto</code>, eu posso ter o seguinte:</p>

<pre><code class="ini">[PATH=/meu/projeto]
opcache.enable=0
</code></pre>

<h2 id="fun%C3%A7%C3%A3o-%60ini_set%60">Fun√ß√£o <code>ini_set</code></h2>

<p>Al√©m dos arquivos <code>.ini</code>, tamb√©m √© poss√≠vel realizar algumas configura√ß√µes no c√≥digo do PHP, que ser√£o v√°lidas apenas durante aquela execu√ß√£o do processo. Para, por exemplo, habilitar a exibi√ß√£o de erros somente durante a execu√ß√£o de um c√≥digo, podemos fazer o seguinte:</p>

<pre><code class="php">ini_set('display_errors', true);
</code></pre>

<p>Na documenta√ß√£o de cada configura√ß√£o √© informado se √© poss√≠vel realiz√°-la atrav√©s da fun√ß√£o <code>ini_set</code> ou apenas a partir de arquivos de configura√ß√£o.</p>

<h2 id="conclus%C3%A3o">Conclus√£o</h2>

<p>Conhecer o <code>php.ini</code> √© de suma import√¢ncia para qualquer pessoa que v√° trabalhar com PHP, seja como <em>dev</em> ou at√© em time de opera√ß√µes/sysadmin. Cada <a href="/2022-02-13-extensoes-php/">extens√£o</a> do PHP vai ter, em sua documenta√ß√£o, a lista de configura√ß√µes poss√≠veis. Sempre que voc√™ for utilizar uma extens√£o como <em>PDO</em>, <em>cURL</em> ou qualquer outra, analise as configura√ß√µes poss√≠veis para saber se h√° alguma poss√≠vel otimiza√ß√£o para seu caso.</p>

<p>Durante o artigo eu deixei alguns links, mas aproveito para deixar algumas refer√™ncias novamente aqui:</p>

<ul>
<li>Post aqui no blog sobre Extens√µes PHP: <a href="/2022-02-13-extensoes-php/">https://dias.dev/2022-02-13-extensoes-php/</a></li>
<li>V√≠deo no meu canal sobre <em>Opcache</em>: <a href="https://youtube.com/watch?v=6vEspHqjrkI">https://youtube.com/watch?v=6vEspHqjrkI</a></li>
<li>Documenta√ß√£o sobre as diretivas do <code>php.ini</code>: <a href="https://www.php.net/manual/en/ini.php">https://www.php.net/manual/en/ini.php</a></li>
<li>Cupom de desconto na Alura para voc√™ se aprofundar em PHP: <a href="https://tidd.ly/4d42Myb">Cupom de desconto</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Enviando e-mails com PHP: uma introdu√ß√£o √† fun√ß√£o mail e ao SMTP]]></title>
            <link href="https://dias.dev/2022-09-27-como-enviar-emails-com-php/"/>
            <updated>2022-09-27T00:00:00+00:00</updated>
            <id>https://dias.dev/2022-09-27-como-enviar-emails-com-php/</id>
            <content type="html"><![CDATA[<blockquote>
  <p>Disclaimer: <em>Esse post foi escrito pela intelig√™ncia artificial do <a href="https://chat.openai.com/chat">ChatGPT</a> contendo apenas poucas altera√ß√µes feitas por mim (Vinicius)</em></p>
</blockquote>

<p>Enviar e-mails √© uma tarefa comum em muitos aplicativos web, e o PHP oferece uma fun√ß√£o nativa chamada <code>mail</code> que pode ser usada para enviar mensagens de e-mail de forma relativamente simples. No entanto, a fun√ß√£o <code>mail</code> tem algumas limita√ß√µes e pode n√£o ser a op√ß√£o mais adequada para todos os casos de uso. Neste post, vamos explorar como a fun√ß√£o <code>mail</code> funciona e quando √© adequada us√°-la, al√©m de introduzir o conceito de Simple Mail Transfer Protocol (SMTP) e apresentar algumas op√ß√µes de bibliotecas de envio de e-mails como PHPMailer e Symfony Mailer.</p>

<h2 id="a-fun%C3%A7%C3%A3o-%60mail%60-do-php">A fun√ß√£o <code>mail</code> do PHP</h2>

<p>A fun√ß√£o <code>mail</code> do PHP √© uma forma simples de enviar e-mails usando a linguagem. Ela √© chamada da seguinte maneira:</p>

<pre><code class="php">mail($to, $subject, $message, $headers, $parameters);
</code></pre>

<p>Onde:</p>

<ul>
<li><code>$to</code> √© o endere√ßo de e-mail do destinat√°rio</li>
<li><code>$subject</code> √© o assunto da mensagem</li>
<li><code>$message</code> √© o corpo da mensagem</li>
<li><code>$headers</code> s√£o cabe√ßalhos adicionais que podem ser inclu√≠dos na mensagem, como o endere√ßo de e-mail do remetente ou o tipo de conte√∫do da mensagem</li>
<li><code>$parameters</code> s√£o par√¢metros adicionais que podem ser passados para a fun√ß√£o</li>
</ul>

<p>A fun√ß√£o retorna <code>true</code> se a mensagem for enviada com sucesso e <code>false</code> caso contr√°rio.</p>

<h3 id="como-a-fun%C3%A7%C3%A3o-%60mail%60-funciona-por-baixo-dos-panos">Como a fun√ß√£o <code>mail</code> funciona por baixo dos panos</h3>

<p>Quando voc√™ chama a fun√ß√£o <code>mail</code> do PHP, ela usa o programa sendmail instalado no servidor para enviar a mensagem. Isso significa que, para que a fun√ß√£o <code>mail</code> funcione, √© necess√°rio que o sendmail esteja configurado e funcionando corretamente no servidor. Al√©m disso, o endere√ßo de e-mail do remetente da mensagem precisa ser v√°lido e o servidor precisa ter permiss√£o para enviar e-mails em nome desse remetente.</p>

<h3 id="limita%C3%A7%C3%B5es-da-fun%C3%A7%C3%A3o-%60mail%60">Limita√ß√µes da fun√ß√£o <code>mail</code></h3>

<p>Apesar de ser uma op√ß√£o conveniente para o envio de e-mails em alguns casos, a fun√ß√£o <code>mail</code> do PHP tem algumas limita√ß√µes que devem ser consideradas:</p>

<ul>
<li>Ela depende do sendmail, que precisa estar instalado e configurado corretamente no servidor. Isso pode ser um problema se voc√™ estiver hospedando o aplicativo em um servi√ßo de nuvem ou em um servidor que n√£o tenha o sendmail instalado.</li>
<li>Ela n√£o oferece muito controle sobre o envio de e-mails. Por exemplo, n√£o √© poss√≠vel definir um servidor SMTP personalizado ou adicionar anexos √† mensagem.</li>
<li>Ela pode ter problemas de entrega de e-mails devido a problemas de configura√ß√£o do sendmail ou de problemas de DNS.</li>
<li>Ela n√£o √© muito confi√°vel em aplicativos de produ√ß√£o, pois pode ser facilmente falsificada e pode ser bloqueada por provedores de e-mail.</li>
</ul>

<p>Essas limita√ß√µes podem ser contornadas usando bibliotecas de envio de e-mails como o PHPMailer ou o Symfony Mailer, que s√£o discutidas no pr√≥ximo t√≥pico.</p>

<h2 id="o-que-%C3%A9-smtp">O que √© SMTP</h2>

<p>SMTP (Simple Mail Transfer Protocol) √© um protocolo usado para enviar e-mails atrav√©s da internet. Ele √© respons√°vel por transferir mensagens de e-mail de um servidor para outro, e tamb√©m pode ser usado para enviar mensagens de e-mail de um cliente para um servidor.</p>

<p>Quando voc√™ envia um e-mail usando um cliente de e-mail como o Microsoft Outlook ou o Gmail, o cliente se comunica com um servidor SMTP para enviar a mensagem. Esse servidor √© respons√°vel por encaminhar a mensagem para o servidor de e-mail do destinat√°rio, que, por sua vez, entrega a mensagem ao cliente de e-mail do destinat√°rio.</p>

<h2 id="pacotes-de-envio-de-e-mails">Pacotes de envio de e-mails</h2>

<p>Se voc√™ precisa de mais flexibilidade do que a fun√ß√£o <code>mail</code> do PHP pode oferecer, existem algumas bibliotecas que podem ser usadas para enviar e-mails com PHP. Dois exemplos populares s√£o o PHPMailer e o Symfony Mailer.</p>

<p>O PHPMailer √© uma das bibliotecas de envio de e-mail mais famosas do ecossistema PHP. Esse componente de c√≥digo aberto que oferece uma interface de alto n√≠vel para o envio de e-mails usando PHP. Ele suporta v√°rios m√©todos de envio, incluindo SMTP, e permite que voc√™ fa√ßa coisas como adicionar anexos e usar templates de e-mail.</p>

<p>Um exemplo de c√≥digo que envia um e-mail usando <code>PHPMailer</code> seria o seguinte:</p>

<pre><code class="php">&lt;?php

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\SMTP;
use PHPMailer\PHPMailer\Exception;

$mail = new PHPMailer(exceptions: true);

try {
    $mail-&gt;isSMTP();

    // Configura√ß√µes do servidor
    $mail-&gt;Host = 'smtp.example.com';
    $mail-&gt;SMTPAuth = true;
    $mail-&gt;Username = 'usuario@example.com';
    $mail-&gt;Password = 'senha-secreta';
    $mail-&gt;SMTPSecure = PHPMailer::ENCRYPTION_SMTPS;
    $mail-&gt;Port = 465;

    // Remetente e Destinat√°rios
    $mail-&gt;setFrom('remetente@example.com', 'Nome do Remetente');
    $mail-&gt;addAddress('destinatario@example.net', 'Primeiro Destinat√°rio');
    $mail-&gt;addAddress('destinatario2@example.com');
    $mail-&gt;addReplyTo('responder@example.com', 'Nome de para quem responder');
    $mail-&gt;addCC('cc@example.com');
    $mail-&gt;addBCC('bcc@example.com');

    // Anexos
    $mail-&gt;addAttachment('/var/tmp/arquivo.tar.gz');
    $mail-&gt;addAttachment('/tmp/imagem.jpg', 'novo-nome.jpg');

    // Conte√∫do
    $mail-&gt;isHTML(true);
    $mail-&gt;Subject = 'Assunto aqui';
    $mail-&gt;Body = 'Esse √© o corpo da mensagem em HTML &lt;b&gt;em negrito!&lt;/b&gt;';
    $mail-&gt;AltBody = 'Esse √© o corpo da mensagem em "texto puro" para clientes que n√£o suportam HTML';

    $mail-&gt;send();
} catch (Exception $exception) {
    echo "Erro ao enviar e-mail: {$mail-&gt;ErrorInfo}";
}
</code></pre>

<h2 id="conclus%C3%A3o%3A">Conclus√£o:</h2>

<p>Enviar e-mails com PHP √© uma tarefa relativamente simples gra√ßas √† fun√ß√£o <code>mail</code> nativa da linguagem. No entanto, essa fun√ß√£o tem algumas limita√ß√µes e pode n√£o ser a op√ß√£o mais adequada para todos os casos de uso. Se voc√™ precisar de mais flexibilidade, pode usar bibliotecas como o PHPMailer ou o Symfony Mailer, que oferecem recursos avan√ßados para o envio de e-mails.</p>

<p>Espero que este post tenha sido √∫til para voc√™ entender as op√ß√µes dispon√≠veis para enviar e-mails com PHP e escolher a op√ß√£o mais adequada para o seu projeto.</p>
]]></content>
        </entry>
    </feed>