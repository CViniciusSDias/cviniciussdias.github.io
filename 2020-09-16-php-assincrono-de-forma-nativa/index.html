<!DOCTYPE html><html lang="pt-BR"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.1e6ddbb1bca063810af0.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-mainHeading:"Fugaz One",Roboto,sans-serif;--font-body:"Baloo 2",Georgia,Cambria,serif;--font-heading:var(--font-body);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#52c196;--color-heading-black:#550766;--color-accent:#f00696}*,:after,:before{box-sizing:border-box}html{line-height:var(--lineHeight-normal);font-size:var(--fontSize-root);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-body);font-size:var(--fontSize-1);color:var(--color-text)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);height:1px;border:0}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);margin-top:var(--spacing-12);margin-bottom:var(--spacing-6);line-height:var(--lineHeight-tight);letter-spacing:-.025em}h2,h3,h4,h5,h6{font-weight:var(--fontWeight-bold);color:var(--color-heading)}h1{font-weight:var(--fontWeight-black);font-size:var(--fontSize-6);color:var(--color-accent)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{line-height:var(--lineHeight-relaxed);--baseline-multiplier:0.179;--x-height-multiplier:0.35;margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{margin-left:var(--spacing-0);margin-right:var(--spacing-0);margin-bottom:var(--spacing-8);list-style-position:outside;list-style-image:none}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{color:var(--color-text-light);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6);border-left:var(--spacing-1) solid var(--color-primary);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{width:100%;margin-bottom:var(--spacing-8);border-collapse:collapse;border-spacing:.25rem}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-5);border-left-width:0;border-right-width:0;padding:var(--spacing-3) 0;border-left-style:solid;border-bottom:var(--spacing-2) solid var(--color-accent);border-right-style:solid;border-top:var(--spacing-2) solid var(--color-heading);text-align:center}.main-heading{font-family:var(--fontFamily-mainHeading);font-size:var(--fontSize-7);font-weight:var(--fontWeight-black);margin:0;color:var(--color-heading-black);text-transform:uppercase}nav.menu{background:var(--color-heading-black);padding:var(--spacing-1) 0;display:flex;justify-content:space-evenly}nav.menu a{color:#fff;font-family:var(--fontFamily-mainHeading);text-decoration:none;display:flex;align-items:flex-start}nav.menu a:hover{text-decoration:underline}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio p{margin-bottom:var(--spacing-0)}.bio strong{color:var(--color-accent)}.bio-avatar{margin-right:var(--spacing-4);margin-bottom:var(--spacing-0);min-width:50px;border-radius:100%}.blog-post{margin-top:var(--spacing-8)}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-size:var(--fontSize-2);font-family:var(--font-heading)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4);margin-left:var(--spacing-0)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@font-face{font-family:Fugaz One;font-style:normal;font-weight:400;font-display:swap;src:local("Fugaz One"),local("FugazOne-Regular"),url(/static/FugazOne-Regular-bb916c7e293e03d98ac838ba18684a8b.ttf) format("truetype"),url(https://fonts.gstatic.com/s/fugazone/v10/rax_HiWKp9EAITukFsl8Axhf.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:Baloo\ 2;font-style:normal;font-weight:400;font-display:swap;src:local("Baloo 2 Regular"),local("Baloo2-Regular"),url(/static/Baloo2-Regular-6208e6316eed6b9e1de0a022ace38958.ttf) format("truetype"),url(https://fonts.gstatic.com/s/baloo2/v1/wXKrE3kTposypRyd51jcAA.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:Baloo\ 2;font-style:normal;font-weight:500;font-display:swap;src:local("Baloo 2 Medium"),local("Baloo2-Medium"),url(/static/Baloo2-Medium-1f413877aed565cf46d36eee02b2d808.ttf) format("truetype"),url(https://fonts.gstatic.com/s/baloo2/v1/wXKuE3kTposypRyd76v_FeMKmA.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:Baloo\ 2;font-style:normal;font-weight:600;font-display:swap;src:local("Baloo 2 SemiBold"),local("Baloo2-SemiBold"),url(/static/Baloo2-SemiBold-ff177ef2da64b35e00a4a95d01cf370f.ttf) format("truetype"),url(https://fonts.gstatic.com/s/baloo2/v1/wXKuE3kTposypRyd74f4FeMKmA.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:Baloo\ 2;font-style:normal;font-weight:700;font-display:swap;src:local("Baloo 2 Bold"),local("Baloo2-Bold"),url(/static/Baloo2-Bold-65719b39434b2c86bea54d53354cb10c.ttf) format("truetype"),url(https://fonts.gstatic.com/s/baloo2/v1/wXKuE3kTposypRyd7-P5FeMKmA.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:Baloo\ 2;font-style:normal;font-weight:800;font-display:swap;src:local("Baloo 2 ExtraBold"),local("Baloo2-ExtraBold"),url(/static/Baloo2-ExtraBold-17c8015d558be1c57e591eba8d55287c.ttf) format("truetype"),url(https://fonts.gstatic.com/s/baloo2/v1/wXKuE3kTposypRyd7__6FeMKmA.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}</style><meta name="generator" content="Gatsby 3.2.1"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=77d9c37a2f41228079811c3cc39ae141" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#550766"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=77d9c37a2f41228079811c3cc39ae141"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=77d9c37a2f41228079811c3cc39ae141"/><title data-react-helmet="true">PHP assíncrono de forma nativa | Dias de Dev</title><meta data-react-helmet="true" name="description" content="O PHP é uma linguagem de programação completa e programação assíncrona não é algo que falta na linguagem. Nesse post eu mostro como atingir este objetivo sem nenhum componente externo"/><meta data-react-helmet="true" property="og:title" content="PHP assíncrono de forma nativa | Dias de Dev"/><meta data-react-helmet="true" property="og:description" content="O PHP é uma linguagem de programação completa e programação assíncrona não é algo que falta na linguagem. Nesse post eu mostro como atingir este objetivo sem nenhum componente externo"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://s.gravatar.com/avatar/63579c5a873f3ab6abff10803e9a252f?s=600"/><meta data-react-helmet="true" property="og:image:width" content="600"/><meta data-react-helmet="true" property="og:image:height" content="600"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="cviniciussdias"/><meta data-react-helmet="true" name="twitter:title" content="PHP assíncrono de forma nativa | Dias de Dev"/><meta data-react-helmet="true" name="twitter:description" content="O PHP é uma linguagem de programação completa e programação assíncrona não é algo que falta na linguagem. Nesse post eu mostro como atingir este objetivo sem nenhum componente externo"/><meta data-react-helmet="true" name="twitter:image" content="https://s.gravatar.com/avatar/63579c5a873f3ab6abff10803e9a252f?s=600"/><meta data-react-helmet="true" name="author" content="Vinicius Dias"/><script>window.dataLayer = window.dataLayer || [];window.dataLayer.push({"platform":"gatsby"}); (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'GTM-5ZJJ977');</script><link rel="canonical" href="https://dias.dev/2020-09-16-php-assincrono-de-forma-nativa/" data-baseprotocol="https:" data-basehost="dias.dev"/><link as="script" rel="preload" href="/webpack-runtime-a0d80196875f0b65c3d6.js"/><link as="script" rel="preload" href="/framework-26912e4c097a2be780ad.js"/><link as="script" rel="preload" href="/app-4925b6820a21bdf5dbef.js"/><link as="script" rel="preload" href="/commons-70f92c7cb9ff71476bea.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-abd6d403de48953cac25.js"/><link as="fetch" rel="preload" href="/page-data/2020-09-16-php-assincrono-de-forma-nativa/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5ZJJ977" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><h3 class="main-heading"><a href="/">Dias de Dev</a></h3></header><nav class="menu"><a href="/">Home</a><a href="/sobre-mim/">Sobre Mim</a><a href="https://youtube.com/DiasDeDev?sub_confirmation=1" target="_blank">YouTube <img src="/img/external-link-symbol.svg" alt="Símbolo de link externo" aria-hidden="true" width="12" height="12"/></a><a href="https://github.com/PHPRio/CFP/issues?q=label%3APalestras+author%3Acviniciussdias" target="_blank">Palestras <img src="/img/external-link-symbol.svg" alt="Símbolo de link externo" aria-hidden="true" width="12" height="12"/></a></nav><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">PHP assíncrono de forma nativa</h1><p itemProp="dateCreated">16 de setembro de 2020</p></header><section itemProp="articleBody"><p>Realizar acesso a streams é uma tarefa relativamente comum para devs PHP. Seja lendo e escrevendo em arquivos, fazendo requisições HTTP, etc.</p>
<p>Operações de I/O são custosas e levam algum tempo para executar. Quando temos diversas operações desse tipo, uma técnica que pode ajudar (e muito) na performance da aplicação é realizá-las de forma assíncrona.</p>
<h2>Acesso a streams</h2>
<p>Antes de falar sobre técnicas e funções que permitem a programação assíncrona, é importante saber como normalmente nós trabalhamos com I/O.</p>
<p>Acesso a arquivos, requisições HTTP, sockets e muito mais pode ser feito através de <a href="https://php.net/streams">streams</a>. Um stream é basicamente um fluxo de dados, sendo que a origem desse fluxo pode variar (vide o início desse parágrafo). Quando utilizamos funções como <code class="language-text">file_get_contents</code>, <code class="language-text">fopen</code>, <code class="language-text">fgets</code>, e as demais, estamos trabalhando com streams do PHP.</p>
<h2>Programação assíncrona</h2>
<p>Se você não está familiarizado com o termo “programação assíncrona”, recomendo assistir este vídeo antes de continuar o artigo:</p>
<p><a href="https://youtu.be/zLfXPSeCkB8">Programação Assíncrona vs Programação Paralela</a></p>
<p>Entendido o que é programação assíncrona, como podemos fazer acesso a streams de forma assíncrona utilizando PHP sem nenhuma extensão ou biblioteca externa? Será possível?</p>
<h2>Eventos</h2>
<p>Programação orientada a eventos não é novidade e nós utilizamos muito na web. Para agir quando um botão for clicado, ou quando um texto for digitado em um <code class="language-text">input</code> nós utilizamos eventos no JavaScript. Eventos podem acontecer a qualquer momento então sua natureza é assíncrona. Mas será possível fazer algo parecido do lado do PHP?</p>
<p>Antes de falar do PHP em si, acho válido citar que o sistema operacional já trabalha com chamadas assíncronas. Diversos eventos acontecem durante a execução do seu sistema, e há código reagindo a estes eventos o tempo todo. Utilizando PHP nós podemos acessar algumas dessas funcionalidades do sistema operacional</p>
<h3>Função stream_select</h3>
<p>Uma função não muito comum para nós que trabalhamos com PHP é a <a href="https://php.net/stream_select">stream_select</a>. Essa função nos permite “observar” modificações que possam acontecer em streams. O probelma é que ela não é nada fácil de se entender, então vou tentar tornar este processo menos doloroso para você.</p>
<h2>Cenário</h2>
<p>Imagine que para executar uma tarefa nós precisemos ler 5 arquivos distintos e depois realizar algum processamento. Normalmente utilizando PHP nós poderíamos fazer algo como:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$conteudoDoArquivo1</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$conteudoDoArquivo2</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo2.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$conteudoDoArquivo3</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo3.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$conteudoDoArquivo4</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo4.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$conteudoDoArquivo5</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo5.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Processar os 5 arquivos</span></span></code></pre></div>
<p>O problema nessa abordagem é óbvio: Antes de ler o <code class="language-text">arquivo2.txt</code> precisamos terminar de ler todo o conteúdo de <code class="language-text">arquivo1.txt</code>. Enquanto o computador espera, nós já poderíamos estar sendo os demais arquivos e os processando de forma individual.</p>
<p>Quando temos uma operação de I/O (acesso a arquivos, rede, etc) sendo realizada de forma síncrona, o processador fica ocioso enquanto a operação não é executada. Ou seja, enquanto o arquivo estiver sendo carregado, o processador fica esperando, sem fazer nada. É exatamente isso que queremos evitar. Queremos garantir que ele continue trabalhando enquanto o arquivo não estiver pronto para leitura.</p>
<h2>Solução com assincronicidade</h2>
<p>Para resolver essa situação, podemos utilizar a função <code class="language-text">stream_select</code> que observa alterações no status de uma lista de streams, ou seja, quando algum dos arquivos estiver pronto para leitura, essa função nos avisará. E é interessante citar que a leitura não necessariamente vai acontecer em ordem. O sistema operacional pode abrir o <code class="language-text">arquivo3.txt</code> mais rápido do que o <code class="language-text">arquivo1.txt</code>, por exemplo. Neste cenário, vamos processá-lo logo, sem ficar esperando os arquivos anteriores.</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$listaDeStreamsDeArquivos</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo1.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo2.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo3.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo4.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo5.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$listaDeStreamsDeArquivos</span> <span class="token keyword">as</span> <span class="token variable">$streamDeArquivo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$streamDeArquivo</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token variable">$streamsParaLer</span> <span class="token operator">=</span> <span class="token variable">$listaDeStreamsDeArquivos</span><span class="token punctuation">;</span>
    <span class="token variable">$streamsComNovidades</span> <span class="token operator">=</span> <span class="token function">stream_select</span><span class="token punctuation">(</span><span class="token variable">$streamsParaLer</span><span class="token punctuation">,</span> <span class="token variable">$write</span><span class="token punctuation">,</span> <span class="token variable">$except</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$streamsComNovidades</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Erro inesperado'</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$streamsComNovidades</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$streamsParaLer</span> <span class="token keyword">as</span> <span class="token variable">$indice</span> <span class="token operator">=></span> <span class="token variable">$streamDeArquivo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$conteudo</span> <span class="token operator">=</span> <span class="token function">stream_get_contents</span><span class="token punctuation">(</span><span class="token variable">$streamDeArquivo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// processa o conteúdo do arquivo</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$streamDeArquivo</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$streamDeArquivo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$listaDeStreamsDeArquivos</span><span class="token punctuation">[</span><span class="token variable">$indice</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$listaDeStreamsDeArquivos</span> <span class="token operator">!==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<h3>Explicação</h3>
<h4>Preparação</h4>
<p>Como eu disse, não é muito fácil, então vamos por partes. Primeiro abrimos todos os arquivos que queremos ler com o <code class="language-text">fopen</code>. Até aí sem segredo. Depois, informamos com a função <code class="language-text">stream_set_blocking</code> que o recurso deve ser aberto em modo não-bloqueante - assim, o processo que acessa o arquivo não bloqueará a CPU por causar um estado de espera ao tentar acessar os arquivos.</p>
<p>Nesse ponto, temos um array com 5 recursos abertos para podermos trabalhar com estes streams. Então analisando o este pedaço de código:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token variable">$listaDeStreamsDeArquivos</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo1.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo2.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo3.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo4.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arquivo5.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$listaDeStreamsDeArquivos</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Teríamos a seguinte saída:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Depois disso que começa a parte difícil. A chamada para a função <code class="language-text">stream_select</code> deve estar em um loop, porque pode acontecer de nem todos os streams estarem prontos para leitura logo de cara.</p>
<h4>Parâmetros</h4>
<p>Segundo detalhe importante: os parâmetros. O 3 primeiros parâmetros dessa função são passados por referência. Por isso o segundo e terceiro são variáveis que nós nem tínhamos definido ainda. O primeiro parâmetro é a lista de streams que queremos observar para ler. O segundo é para escrita. Já o terceiro, menos comum, é para dados excepcionais que possuem maior prioridade. Os 2 últimos parâmetros são sobre timeout.</p>
<p>O parâmetro passado como 1 indica o número de segundos que essa função deve esperar receber uma notificação de novidade nos streams até “desistir”, ou seja, o timeout. Esse é o motivo pelo qual ela deve estar em um loop. Se esse tempo passar e nós não tivermos novidade, devemos tentar de novo depois. Caso algum (não necessariamente todos) stream esteja pronto antes desse 1 segundo, a função retornará. O último parâmetro, que informamos como 0, indica o tempo em microsegundos para timeout.</p>
<h4>Retorno e leitura</h4>
<p>Agora vamos falar do retorno. Essa função retorna o número de streams que contém modificações. No nosso caso, vai informar quantos arquivos estão prontos para leitura. Porém em caso de erro essa função nos retorna o valor <code class="language-text">false</code>.</p>
<p>Além disso, os parâmetros que nós passamos podem ter sido modificados. Por isso eu realizo uma cópia da lista original de streams em <code class="language-text">$arquivosParaLer = $listaDeArquivos;</code>. Após o retorno da função, o parâmetro passado vai conter apenas os streams que possuem novidades, ou seja, no nosso caso, os arquivos que estão prontos para leitura.</p>
<p>Para exemplificar, vamos supor que na primeira execução do loop todos os arquivos já estejam disponíveis. Nesse caso, analisando os valores das variáveis, podemos entender o que está acontecendo. Analisando então o valor de <code class="language-text">$streamsComNovidades</code>, teríamos <code class="language-text">int(5)</code> como resultado deste cenário.</p>
<p>Já analisando ambos arrays de streams (<code class="language-text">$listaDeStreamsDeArquivos</code> e <code class="language-text">$streamsParaLer</code>), teríamos exatamente o mesmo resultado:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Agora caso na primeira execução tivéssemos apenas 3 dos 5 arquivos prontos, e analisássemos os 3 valores anteriores, teríamos ter algo como:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$streamsComNovidades</span><span class="token punctuation">,</span> <span class="token variable">$listaDeStreamsDeArquivos</span><span class="token punctuation">,</span> <span class="token variable">$streamsParaLer</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=></span>
  <span class="token function">resource</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> of <span class="token function">type </span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Onde, nesse caso, o segundo array exibido é o de <code class="language-text">$streamsParaLer</code>, e possui apenas os 3 arquivos prontos para leitura.</p>
<p>Sendo assim, posso percorrer este array tendo a certeza de que há dados para ler e processar. Mas não há garantia de que todo o conteúdo do arquivo estará lá, por isso verifico se cheguei ao fim do arquivo com <code class="language-text">feof</code>. Para arquivos pequenos, via de regra, todo o conteúdo virá de uma vez só, mas não conte com isso e prepare seu código para ler até mesmo um único byte por vez.</p>
<p>Após ler todo o arquivo, devemos fechá-lo. Mas um outro detalhe importante é que eu também o removo da lista original de streams que queremos ler. Faço isso para que caso seja necessária uma nova iteração no loop, ou seja, caso nem todos os arquivos tenham sido lidos, eu não tente ler novamente os arquivos que já foram lidos e fechados.</p>
<p>Com isso temos nossa condição de saída do loop. Quando todos os arquivos tiverem sido removidos e minha lista estiver vazia, sei que processei todos os arquivos.</p>
<p>PS.: A função <code class="language-text">stream_set_blocking</code> só surte efeito com arquivos e sockets. Os outros wrappers, com esta técnica, não podem ser lidos de forma assíncrona e não bloqueante.</p>
<h2>Conceitos</h2>
<p>Esse código obviamente pode ser refatorado para torná-lo um pouco mais legível, mas acredito que a lógica por trás dele tenha ficado clara. Caso contrário, você pode usar a sessão de comentários dessa página para fazer perguntas.</p>
<p>O que nós escrevemos de forma rudimentar aqui pode ser visto como uma implementação do que é conhecido como <em>Event Loop</em>, ou loop de eventos. Você provavelmente já ouviu esse termo se estuda sobre a runtime Node.js.</p>
<p>Claro que essa implementação não é completa ou otimizada, mas atende nosso propósito: ler arquivos conforme eles fiquem prontos para leitura. Dessa forma nós vamos pedir para que o sistema operacional prepare todos os arquivos para leitura de uma só vez.</p>
<p>As vantagens nessa abordagem assíncrona são mais perceptíveis quando temos operações mais lentas como chamadas HTTP, por exemplo. Mas isso aumentaria a complexidade do código para este artigo.</p>
<h2>Conclusão</h2>
<p>Claro que o PHP já possui ferramentas que realizam este trabalho de forma muito mais simples. ReactPHP com seu pacote de Streams é um ótimo exemplo.</p>
<p>Mas seguindo o que citei no post sobre aprendizado, eu penso como <a href="https://pt.wikipedia.org/wiki/Richard_Feynman">Richard Feynman</a> (Nobel de física): “O que eu não consigo criar, eu não entendo”. Então antes de utilizar uma ferramenta que realiza o trabalho para mim, eu gosto de saber como realizar este trabalho sem ela. Com isso, se algum problema acontecer com a biblioteca, por exemplo, eu vou estar mais preparado para resolvê-lo já que eu entendo um pouco melhor como as coisas funcionam.</p>
<p>Além disso, se chamadas HTTP assíncronas com essa técnica é um assunto que te interessa, interaja com essa publicação para que eu produza um conteúdo sobre isso.</p></section><hr/><footer><div class="bio"><div style="margin-right:var(--spacing-4)"><img src="https://gravatar.com/avatar/63579c5a873f3ab6abff10803e9a252f.jpg?s=50" alt="Foto de Vinicius Dias segurando um microfone durante uma palestra" style="border-radius:50%;width:50.01px;height:50.01px"/></div><p>Escrito por <strong>Vinicius Dias</strong> <!-- -->que sempre tenta seguir a regra do bom escoteiro: &quot;Sempre deixe o código mais limpo do que quando você encontrou&quot;<!-- --> <a href="https://twitter.com/cviniciussdias">Que tal seguir ele no Twitter?</a></p></div><div id="disqus_thread"></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/2020-04-23-principios-ou-ferramentas-o-que-estudar/">← <!-- -->Princípios ou Ferramentas - O que estudar</a></li><li><a rel="next" href="/2020-10-27-php-alem-da-web/">PHP além da Web<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2021<!-- -->, Dias de Dev</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2020-09-16-php-assincrono-de-forma-nativa/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-8cf18f7d5cc4f33181df.js"],"app":["/app-4925b6820a21bdf5dbef.js"],"component---src-pages-404-js":["/component---src-pages-404-js-97593667e44e4660bc60.js"],"component---src-pages-index-js":["/component---src-pages-index-js-daf533cf1073f7016048.js"],"component---src-pages-sobre-mim-js":["/component---src-pages-sobre-mim-js-3c666a2cb764dfab5945.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-abd6d403de48953cac25.js"]};/*]]>*/</script><script src="/polyfill-8cf18f7d5cc4f33181df.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-abd6d403de48953cac25.js" async=""></script><script src="/commons-70f92c7cb9ff71476bea.js" async=""></script><script src="/app-4925b6820a21bdf5dbef.js" async=""></script><script src="/framework-26912e4c097a2be780ad.js" async=""></script><script src="/webpack-runtime-a0d80196875f0b65c3d6.js" async=""></script></body></html>